(()=>{var Le=Object.defineProperty;var zt=e=>Le(e,"__esModule",{value:!0});var ne=(e,t)=>{zt(e);for(var r in t)Le(e,r,{get:t[r],enumerable:!0})};var De=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var S=(e,t,r)=>(De(e,t,"read from private field"),r?r.call(e):t.get(e)),oe=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},xe=(e,t,r,i)=>(De(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);var M=1e-6,I=typeof Float32Array!="undefined"?Float32Array:Array,G=Math.random;var Xn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var d={};ne(d,{add:()=>lr,adjoint:()=>Qt,clone:()=>Yt,copy:()=>qt,create:()=>Ht,determinant:()=>Jt,equals:()=>vr,exactEquals:()=>pr,frob:()=>ur,fromMat2d:()=>ar,fromMat4:()=>Wt,fromQuat:()=>sr,fromRotation:()=>nr,fromScaling:()=>or,fromTranslation:()=>ir,fromValues:()=>Xt,identity:()=>Kt,invert:()=>Zt,mul:()=>gr,multiply:()=>Ce,multiplyScalar:()=>mr,multiplyScalarAndAdd:()=>dr,normalFromMat4:()=>cr,projection:()=>hr,rotate:()=>tr,scale:()=>rr,set:()=>$t,str:()=>fr,sub:()=>xr,subtract:()=>Ue,translate:()=>er,transpose:()=>jt});function Ht(){var e=new I(9);return I!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Wt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Yt(e){var t=new I(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function qt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Xt(e,t,r,i,n,o,a,s,c){var h=new I(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=i,h[4]=n,h[5]=o,h[6]=a,h[7]=s,h[8]=c,h}function $t(e,t,r,i,n,o,a,s,c,h){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=o,e[5]=a,e[6]=s,e[7]=c,e[8]=h,e}function Kt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function jt(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Zt(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],c=t[6],h=t[7],u=t[8],m=u*a-s*h,l=-u*o+s*c,p=h*o-a*c,x=r*m+i*l+n*p;return x?(x=1/x,e[0]=m*x,e[1]=(-u*i+n*h)*x,e[2]=(s*i-n*a)*x,e[3]=l*x,e[4]=(u*r-n*c)*x,e[5]=(-s*r+n*o)*x,e[6]=p*x,e[7]=(-h*r+i*c)*x,e[8]=(a*r-i*o)*x,e):null}function Qt(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],c=t[6],h=t[7],u=t[8];return e[0]=a*u-s*h,e[1]=n*h-i*u,e[2]=i*s-n*a,e[3]=s*c-o*u,e[4]=r*u-n*c,e[5]=n*o-r*s,e[6]=o*h-a*c,e[7]=i*c-r*h,e[8]=r*a-i*o,e}function Jt(e){var t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],c=e[7],h=e[8];return t*(h*o-a*c)+r*(-h*n+a*s)+i*(c*n-o*s)}function Ce(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],l=r[0],p=r[1],x=r[2],E=r[3],A=r[4],f=r[5],v=r[6],T=r[7],_=r[8];return e[0]=l*i+p*a+x*h,e[1]=l*n+p*s+x*u,e[2]=l*o+p*c+x*m,e[3]=E*i+A*a+f*h,e[4]=E*n+A*s+f*u,e[5]=E*o+A*c+f*m,e[6]=v*i+T*a+_*h,e[7]=v*n+T*s+_*u,e[8]=v*o+T*c+_*m,e}function er(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],l=r[0],p=r[1];return e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=s,e[5]=c,e[6]=l*i+p*a+h,e[7]=l*n+p*s+u,e[8]=l*o+p*c+m,e}function tr(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],l=Math.sin(r),p=Math.cos(r);return e[0]=p*i+l*a,e[1]=p*n+l*s,e[2]=p*o+l*c,e[3]=p*a-l*i,e[4]=p*s-l*n,e[5]=p*c-l*o,e[6]=h,e[7]=u,e[8]=m,e}function rr(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ir(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function nr(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function or(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ar(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function sr(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r+r,s=i+i,c=n+n,h=r*a,u=i*a,m=i*s,l=n*a,p=n*s,x=n*c,E=o*a,A=o*s,f=o*c;return e[0]=1-m-x,e[3]=u-f,e[6]=l+A,e[1]=u+f,e[4]=1-h-x,e[7]=p-E,e[2]=l-A,e[5]=p+E,e[8]=1-h-m,e}function cr(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],c=t[6],h=t[7],u=t[8],m=t[9],l=t[10],p=t[11],x=t[12],E=t[13],A=t[14],f=t[15],v=r*s-i*a,T=r*c-n*a,_=r*h-o*a,L=i*c-n*s,me=i*h-o*s,de=n*h-o*c,pe=u*E-m*x,ve=u*A-l*x,j=u*f-p*x,ge=m*A-l*E,Z=m*f-p*E,Q=l*f-p*A,C=v*Q-T*Z+_*ge+L*j-me*ve+de*pe;return C?(C=1/C,e[0]=(s*Q-c*Z+h*ge)*C,e[1]=(c*j-a*Q-h*ve)*C,e[2]=(a*Z-s*j+h*pe)*C,e[3]=(n*Z-i*Q-o*ge)*C,e[4]=(r*Q-n*j+o*ve)*C,e[5]=(i*j-r*Z-o*pe)*C,e[6]=(E*de-A*me+f*L)*C,e[7]=(A*_-x*de-f*T)*C,e[8]=(x*me-E*_+f*v)*C,e):null}function hr(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function fr(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function ur(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function lr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function Ue(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function mr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function dr(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function pr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function vr(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],c=e[6],h=e[7],u=e[8],m=t[0],l=t[1],p=t[2],x=t[3],E=t[4],A=t[5],f=t[6],v=t[7],T=t[8];return Math.abs(r-m)<=M*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(i-l)<=M*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(n-p)<=M*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-x)<=M*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-E)<=M*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-A)<=M*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(c-f)<=M*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(h-v)<=M*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(u-T)<=M*Math.max(1,Math.abs(u),Math.abs(T))}var gr=Ce,xr=Ue;var R={};ne(R,{add:()=>Sr,angle:()=>Yr,bezier:()=>Gr,ceil:()=>wr,clone:()=>br,copy:()=>Tr,create:()=>Be,cross:()=>Ur,dist:()=>Jr,distance:()=>Oe,div:()=>Qr,divide:()=>Ve,dot:()=>He,equals:()=>Kr,exactEquals:()=>$r,floor:()=>Er,forEach:()=>ii,fromValues:()=>yr,hermite:()=>Fr,inverse:()=>Dr,len:()=>ti,length:()=>Fe,lerp:()=>Br,max:()=>Mr,min:()=>Ar,mul:()=>Zr,multiply:()=>ke,negate:()=>Lr,normalize:()=>Cr,random:()=>kr,rotateX:()=>zr,rotateY:()=>Hr,rotateZ:()=>Wr,round:()=>Rr,scale:()=>Pr,scaleAndAdd:()=>Ir,set:()=>_r,sqrDist:()=>ei,sqrLen:()=>ri,squaredDistance:()=>Ne,squaredLength:()=>ze,str:()=>Xr,sub:()=>jr,subtract:()=>Ge,transformMat3:()=>Or,transformMat4:()=>Vr,transformQuat:()=>Nr,zero:()=>qr});function Be(){var e=new I(3);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function br(e){var t=new I(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Fe(e){var t=e[0],r=e[1],i=e[2];return Math.hypot(t,r,i)}function yr(e,t,r){var i=new I(3);return i[0]=e,i[1]=t,i[2]=r,i}function Tr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _r(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function Sr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Ge(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function ke(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ve(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function wr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Er(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Ar(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Mr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Rr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Pr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Ir(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function Oe(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.hypot(r,i,n)}function Ne(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function ze(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function Lr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Dr(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Cr(e,t){var r=t[0],i=t[1],n=t[2],o=r*r+i*i+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function He(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ur(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],c=r[2];return e[0]=n*c-o*s,e[1]=o*a-i*c,e[2]=i*s-n*a,e}function Br(e,t,r,i){var n=t[0],o=t[1],a=t[2];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e}function Fr(e,t,r,i,n,o){var a=o*o,s=a*(2*o-3)+1,c=a*(o-2)+o,h=a*(o-1),u=a*(3-2*o);return e[0]=t[0]*s+r[0]*c+i[0]*h+n[0]*u,e[1]=t[1]*s+r[1]*c+i[1]*h+n[1]*u,e[2]=t[2]*s+r[2]*c+i[2]*h+n[2]*u,e}function Gr(e,t,r,i,n,o){var a=1-o,s=a*a,c=o*o,h=s*a,u=3*o*s,m=3*c*a,l=c*o;return e[0]=t[0]*h+r[0]*u+i[0]*m+n[0]*l,e[1]=t[1]*h+r[1]*u+i[1]*m+n[1]*l,e[2]=t[2]*h+r[2]*u+i[2]*m+n[2]*l,e}function kr(e,t){t=t||1;var r=G()*2*Math.PI,i=G()*2-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e}function Vr(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,e[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,e[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,e}function Or(e,t,r){var i=t[0],n=t[1],o=t[2];return e[0]=i*r[0]+n*r[3]+o*r[6],e[1]=i*r[1]+n*r[4]+o*r[7],e[2]=i*r[2]+n*r[5]+o*r[8],e}function Nr(e,t,r){var i=r[0],n=r[1],o=r[2],a=r[3],s=t[0],c=t[1],h=t[2],u=n*h-o*c,m=o*s-i*h,l=i*c-n*s,p=n*l-o*m,x=o*u-i*l,E=i*m-n*u,A=a*2;return u*=A,m*=A,l*=A,p*=2,x*=2,E*=2,e[0]=s+u+p,e[1]=c+m+x,e[2]=h+l+E,e}function zr(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0],o[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),o[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Hr(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),o[1]=n[1],o[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Wr(e,t,r,i){var n=[],o=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],o[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),o[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),o[2]=n[2],e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e}function Yr(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],a=t[1],s=t[2],c=Math.sqrt(r*r+i*i+n*n),h=Math.sqrt(o*o+a*a+s*s),u=c*h,m=u&&He(e,t)/u;return Math.acos(Math.min(Math.max(m,-1),1))}function qr(e){return e[0]=0,e[1]=0,e[2]=0,e}function Xr(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function $r(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Kr(e,t){var r=e[0],i=e[1],n=e[2],o=t[0],a=t[1],s=t[2];return Math.abs(r-o)<=M*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=M*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=M*Math.max(1,Math.abs(n),Math.abs(s))}var jr=Ge,Zr=ke,Qr=Ve,Jr=Oe,ei=Ne,ti=Fe,ri=ze,ii=function(){var e=Be();return function(t,r,i,n,o,a){var s,c;for(r||(r=3),i||(i=0),n?c=Math.min(n*r+i,t.length):c=t.length,s=i;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();var y={};ne(y,{add:()=>ci,ceil:()=>hi,clone:()=>ni,copy:()=>ai,create:()=>We,cross:()=>yi,dist:()=>Di,distance:()=>$e,div:()=>Li,divide:()=>Xe,dot:()=>bi,equals:()=>Ri,exactEquals:()=>Mi,floor:()=>fi,forEach:()=>Fi,fromValues:()=>oi,inverse:()=>gi,len:()=>Ui,length:()=>je,lerp:()=>Ti,max:()=>li,min:()=>ui,mul:()=>Ii,multiply:()=>qe,negate:()=>vi,normalize:()=>xi,random:()=>_i,round:()=>mi,scale:()=>di,scaleAndAdd:()=>pi,set:()=>si,sqrDist:()=>Ci,sqrLen:()=>Bi,squaredDistance:()=>Ke,squaredLength:()=>Ze,str:()=>Ai,sub:()=>Pi,subtract:()=>Ye,transformMat4:()=>Si,transformQuat:()=>wi,zero:()=>Ei});function We(){var e=new I(4);return I!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ni(e){var t=new I(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function oi(e,t,r,i){var n=new I(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n}function ai(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function si(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e}function ci(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Ye(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function qe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Xe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function hi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function fi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function ui(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function li(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function mi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function di(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function pi(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e}function $e(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return Math.hypot(r,i,n,o)}function Ke(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],o=t[3]-e[3];return r*r+i*i+n*n+o*o}function je(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.hypot(t,r,i,n)}function Ze(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function vi(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function gi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function xi(e,t){var r=t[0],i=t[1],n=t[2],o=t[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=i*a,e[2]=n*a,e[3]=o*a,e}function bi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function yi(e,t,r,i){var n=r[0]*i[1]-r[1]*i[0],o=r[0]*i[2]-r[2]*i[0],a=r[0]*i[3]-r[3]*i[0],s=r[1]*i[2]-r[2]*i[1],c=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],u=t[0],m=t[1],l=t[2],p=t[3];return e[0]=m*h-l*c+p*s,e[1]=-(u*h)+l*a-p*o,e[2]=u*c-m*a+p*n,e[3]=-(u*s)+m*o-l*n,e}function Ti(e,t,r,i){var n=t[0],o=t[1],a=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e[2]=a+i*(r[2]-a),e[3]=s+i*(r[3]-s),e}function _i(e,t){t=t||1;var r,i,n,o,a,s;do r=G()*2-1,i=G()*2-1,a=r*r+i*i;while(a>=1);do n=G()*2-1,o=G()*2-1,s=n*n+o*o;while(s>=1);var c=Math.sqrt((1-a)/s);return e[0]=t*r,e[1]=t*i,e[2]=t*n*c,e[3]=t*o*c,e}function Si(e,t,r){var i=t[0],n=t[1],o=t[2],a=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,e[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,e[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,e[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,e}function wi(e,t,r){var i=t[0],n=t[1],o=t[2],a=r[0],s=r[1],c=r[2],h=r[3],u=h*i+s*o-c*n,m=h*n+c*i-a*o,l=h*o+a*n-s*i,p=-a*i-s*n-c*o;return e[0]=u*h+p*-a+m*-c-l*-s,e[1]=m*h+p*-s+l*-a-u*-c,e[2]=l*h+p*-c+u*-s-m*-a,e[3]=t[3],e}function Ei(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ai(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Mi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Ri(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],a=t[0],s=t[1],c=t[2],h=t[3];return Math.abs(r-a)<=M*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=M*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-c)<=M*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-h)<=M*Math.max(1,Math.abs(o),Math.abs(h))}var Pi=Ye,Ii=qe,Li=Xe,Di=$e,Ci=Ke,Ui=je,Bi=Ze,Fi=function(){var e=We();return function(t,r,i,n,o,a){var s,c;for(r||(r=4),i||(i=0),n?c=Math.min(n*r+i,t.length):c=t.length,s=i;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();var b={};ne(b,{add:()=>Ni,angle:()=>cn,ceil:()=>zi,clone:()=>Gi,copy:()=>Vi,create:()=>Qe,cross:()=>Ji,dist:()=>gn,distance:()=>rt,div:()=>vn,divide:()=>tt,dot:()=>Qi,equals:()=>ln,exactEquals:()=>un,floor:()=>Hi,forEach:()=>yn,fromValues:()=>ki,inverse:()=>ji,len:()=>mn,length:()=>nt,lerp:()=>en,max:()=>Yi,min:()=>Wi,mul:()=>pn,multiply:()=>et,negate:()=>Ki,normalize:()=>Zi,random:()=>tn,rotate:()=>sn,round:()=>qi,scale:()=>Xi,scaleAndAdd:()=>$i,set:()=>Oi,sqrDist:()=>xn,sqrLen:()=>bn,squaredDistance:()=>it,squaredLength:()=>ot,str:()=>fn,sub:()=>dn,subtract:()=>Je,transformMat2:()=>rn,transformMat2d:()=>nn,transformMat3:()=>on,transformMat4:()=>an,zero:()=>hn});function Qe(){var e=new I(2);return I!=Float32Array&&(e[0]=0,e[1]=0),e}function Gi(e){var t=new I(2);return t[0]=e[0],t[1]=e[1],t}function ki(e,t){var r=new I(2);return r[0]=e,r[1]=t,r}function Vi(e,t){return e[0]=t[0],e[1]=t[1],e}function Oi(e,t,r){return e[0]=t,e[1]=r,e}function Ni(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function et(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function tt(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function zi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Hi(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Wi(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Yi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function qi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Xi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function $i(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function rt(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.hypot(r,i)}function it(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function nt(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function ot(e){var t=e[0],r=e[1];return t*t+r*r}function Ki(e,t){return e[0]=-t[0],e[1]=-t[1],e}function ji(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function Zi(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function Qi(e,t){return e[0]*t[0]+e[1]*t[1]}function Ji(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function en(e,t,r,i){var n=t[0],o=t[1];return e[0]=n+i*(r[0]-n),e[1]=o+i*(r[1]-o),e}function tn(e,t){t=t||1;var r=G()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function rn(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e}function nn(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e}function on(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function an(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e}function sn(e,t,r,i){var n=t[0]-r[0],o=t[1]-r[1],a=Math.sin(i),s=Math.cos(i);return e[0]=n*s-o*a+r[0],e[1]=n*a+o*s+r[1],e}function cn(e,t){var r=e[0],i=e[1],n=t[0],o=t[1],a=Math.sqrt(r*r+i*i)*Math.sqrt(n*n+o*o),s=a&&(r*n+i*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function hn(e){return e[0]=0,e[1]=0,e}function fn(e){return"vec2("+e[0]+", "+e[1]+")"}function un(e,t){return e[0]===t[0]&&e[1]===t[1]}function ln(e,t){var r=e[0],i=e[1],n=t[0],o=t[1];return Math.abs(r-n)<=M*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-o)<=M*Math.max(1,Math.abs(i),Math.abs(o))}var mn=nt,dn=Je,pn=et,vn=tt,gn=rt,xn=it,bn=ot,yn=function(){var e=Qe();return function(t,r,i,n,o,a){var s,c;for(r||(r=2),i||(i=0),n?c=Math.min(n*r+i,t.length):c=t.length,s=i;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}}();function be(e){let t=document.createElement("canvas");t.style.imageRendering="pixelated";let r=t.getContext("webgl2",{alpha:!1,premultipliedAlpha:!1});if(!r)return console.error("Unable to initialize WebGL. Your browser or machine may not support it."),null;let i=null,n={width:1,height:1},o={offsetLeft:0,offsetTop:0,width:1,height:1},a={gl:r,editor:null,createOffscreenCanvas:(f,v,T)=>{let _=document.createElement("canvas");_.width=f,_.height=v;let L=_.getContext("2d",T);return L||console.error("Unable to initialize OffscreenCanvas. Your browser or machine may not support it."),L},canvas:t,getGamepad:()=>i!==null?navigator.getGamepads()[i]:null,keys:{down:new Set,pressed:new Set},mouse:{position:b.create(),wheel:b.create(),down:[],clicked:[]},touches:{down:new Map,ended:new Map},screen:{get width(){return n.width},get height(){return n.height},safeArea:{get width(){return n.width},get height(){return n.height},get boundingRect(){return y.fromValues(o.offsetTop,o.offsetLeft+o.width,o.offsetTop+o.height,o.offsetLeft)}},toScreenSpace:(f,v)=>y.set(f,v[0]/n.height,v[1]/n.width,v[2]/n.height,v[3]/n.width)}},s=1;window.addEventListener("gamepadconnected",f=>{i=f.gamepad.index}),window.addEventListener("gamepaddisconnected",f=>{i=null}),window.addEventListener("keydown",f=>{a.keys.down.add(f.key),(f.altKey||f.shiftKey||f.ctrlKey)&&f.preventDefault()}),window.addEventListener("keyup",f=>{a.keys.down.has(f.key)&&a.keys.pressed.add(f.key),a.keys.down.delete(f.key),(f.altKey||f.shiftKey||f.ctrlKey)&&f.preventDefault()}),t.addEventListener("wheel",f=>{f.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&b.set(a.mouse.wheel,f.deltaX,f.deltaY)}),t.addEventListener("mousemove",f=>{let v=t.getBoundingClientRect();b.set(a.mouse.position,(f.clientX-v.left)/s,(f.clientY-v.top)/s)}),t.addEventListener("mousedown",f=>{a.mouse.down[f.button]=!0}),t.addEventListener("mouseup",f=>{a.mouse.down[f.button]&&(a.mouse.clicked[f.button]=!0),a.mouse.down[f.button]=!1}),t.addEventListener("contextmenu",f=>{f.preventDefault()}),t.addEventListener("touchstart",f=>{let v=t.getBoundingClientRect();for(let T=0;T<f.changedTouches.length;++T){let _=f.changedTouches[T],L=b.fromValues((_.clientX-v.left)/s,(_.clientY-v.top)/s);L[0]>=0&&L[1]>=0&&L[0]<=a.screen.width&&L[1]<=a.screen.height&&a.touches.down.set(_.identifier,{started:Date.now(),position:L})}f.preventDefault()}),t.addEventListener("touchmove",f=>{let v=t.getBoundingClientRect();for(let T=0;T<f.changedTouches.length;++T){let _=f.changedTouches[T],L=a.touches.down.get(_.identifier);L&&b.set(L.position,(_.clientX-v.left)/s,(_.clientY-v.top)/s)}f.preventDefault()}),t.addEventListener("touchend",f=>{let v=t.getBoundingClientRect();for(let T=0;T<f.changedTouches.length;++T){let _=f.changedTouches[T],L=a.touches.down.get(_.identifier);L&&(b.set(L.position,(_.clientX-v.left)/s,(_.clientY-v.top)/s),a.touches.down.delete(_.identifier),a.touches.ended.set(_.identifier,{position:L.position}))}f.preventDefault()}),t.addEventListener("touchcancel",f=>{for(let v=0;v<f.changedTouches.length;++v){let T=f.changedTouches[v];a.touches.down.get(T.identifier)&&a.touches.down.delete(T.identifier)}f.preventDefault()});let c=performance.now(),h=!1,u=null,m=async()=>{let f=localStorage.getItem(e.saveKey);try{u=await e.start(a,f?JSON.parse(f):void 0),c=performance.now()}catch(v){console.warn(v),u=await e.start(a),c=performance.now()}};t.addEventListener("webglcontextlost",f=>{f.preventDefault(),h=!0,console.warn("WebGL context lost, saving state..."),u&&localStorage.setItem(e.saveKey,JSON.stringify(e.save(u)))},!1),t.addEventListener("webglcontextrestored",f=>{f.preventDefault(),a.gl=t.getContext("webgl2"),console.warn("WebGL context restored, loading state..."),m().then(v=>{h=!1})},!1),m();let l=0,p=null,x=()=>{if(u){let f=performance.now(),v=f-c;for(c=f,l+=v;l>=e.fixedUpdate;)e.update(a,u,e.fixedUpdate),a.mouse.clicked=[],b.set(a.mouse.wheel,0,0),a.touches.ended.clear(),a.keys.pressed.clear(),l-=e.fixedUpdate;h||e.draw(a,u,v)}p=requestAnimationFrame(x)};p=requestAnimationFrame(x);let E=()=>{document.visibilityState==="hidden"?(u&&(console.warn("Visibility changing, saving state..."),localStorage.setItem(e.saveKey,JSON.stringify(e.save(u)))),p&&cancelAnimationFrame(p)):(c=performance.now(),l=0,p=requestAnimationFrame(x))};window.addEventListener("visibilitychange",E);let A=()=>{if(s=1,window.innerWidth>=window.innerHeight){for(n.width=Math.min(e.screen.preferredWidthIncrements,Math.floor(window.innerWidth/e.screen.incrementSize))*e.screen.incrementSize;n.width*(s+1)<window.innerWidth;)++s;n.height=Math.floor(window.innerHeight/(e.screen.incrementSize*s))*e.screen.incrementSize}else{for(n.height=Math.min(e.screen.preferredHeightIncrements,Math.floor(window.innerHeight/e.screen.incrementSize))*e.screen.incrementSize;n.height*(s+1)<window.innerHeight;)++s;n.width=Math.floor(window.innerWidth/(e.screen.incrementSize*s))*e.screen.incrementSize}for(;n.width*s<window.innerWidth;)n.width+=e.screen.incrementSize;for(;n.height*s<window.innerHeight;)n.height+=e.screen.incrementSize;let f=(n.width*s-window.innerWidth)/2,v=(n.height*s-window.innerHeight)/2;o.offsetLeft=f,o.offsetTop=v,o.width=n.width-f*2,o.height=n.height-v*2,t&&(t.setAttribute("width",n.width.toString()),t.setAttribute("height",n.height.toString()),t.style.top=-v+"px",t.style.left=-f+"px",t.style.width=s*n.width+"px",t.style.height=s*n.height+"px")};return A(),window.addEventListener("resize",A),t}var w=Symbol();async function W(e,t,r){let i=await st(t);return{[w]:ct(e,i,r),width:i.width,height:i.height}}async function at(e,t,r){let i=await st(t);return{image:i,[w]:ct(e,i,r),width:i.width,height:i.height}}function st(e){return new Promise((t,r)=>{let i=new Image;i.onload=()=>t(i),i.onerror=n=>r(n),i.src=e})}function ct(e,t,r){let i=e.gl.createTexture();return e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,i),e.gl.pixelStorei(e.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_S,r?.wrap||e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_T,r?.wrap||e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MIN_FILTER,r?.wrap||e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MAG_FILTER,r?.wrap||e.gl.LINEAR),e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,e.gl.RGBA,e.gl.UNSIGNED_BYTE,t),e.gl.bindTexture(e.gl.TEXTURE_2D,null),i}async function ae(e,t,r){let i=await r(e,t);return Tn(t,i)}function Tn(e,t){return Object.keys(e.sprites).reduce((r,i)=>{let n=e.sprites[i],o=n.frames.map(a=>y.fromValues(a.top,a.right,a.bottom,a.left));return r[i]={index:n.index,width:n.width,height:n.height,frames:o,draw:(a,s,c=0)=>(a.setTextures(t),a.draw(s,o[Math.floor(c)%o.length]),r[i])},r},{})}var se=class{#e;#t;#i;constructor(t,r,i){this.frameRate=i,this.frame=0,this.#e=t,this.#i=r,this.#t=t[r]}tick(t){this.frame+=t*this.frameRate,this.frame>this.#t.frames.length&&(this.frame-=this.#t.frames.length)}getSprite(){return this.#t}getSpriteName(){return this.#i}setSprite(t){let r=this.#e[t];r!==this.#t&&(this.#t=r,this.#i=t,this.frame=0)}setSpriteOrTick(t,r){let i=this.#e[t];i!==this.#t?(this.#t=i,this.#i=t,this.frame=0):this.tick(r)}draw(t,r,i=0){this.#t.draw(t,r,this.frame+i)}};var Y=d.create();d.scale(Y,Y,[1,-1]);d.translate(Y,Y,[-1,-1]);d.scale(Y,Y,[2,2]);var O=Y,F=class{#e;#t;#i;#n;#r;constructor(t){this.#t=t,this.#r="",this.#n=null,this.#i=this.#t.createVertexArray();let r=new Float32Array([0,0,1,0,0,1,1,1]);this.#e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.#e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null)}#o(t,r){let i={position:t.inAttributes[r.position].location};return{...i,hash:`${i.position}`}}bind(t,r,i){let n=this.#o(t,r);this.#t.bindVertexArray(this.#i),(this.#r!==n.hash||this.#n!==null)&&(this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.enableVertexAttribArray(n.position),this.#t.vertexAttribPointer(n.position,2,this.#t.FLOAT,!1,0,0),this.#r=n.hash,this.#n=null),i({draw:()=>{this.#t.drawArrays(this.#t.TRIANGLE_STRIP,0,4)}}),this.#t.bindVertexArray(null)}bindInstances(t,r,i,n){let o=this.#o(t,r),a=i.getAttributesHash(t),s=`${o.hash}:${a}`;this.#t.bindVertexArray(this.#i),(this.#r!==s||this.#n!==i)&&(this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.enableVertexAttribArray(o.position),this.#t.vertexAttribPointer(o.position,2,this.#t.FLOAT,!1,0,0),this.#r=s,this.#n=i.bind(t));let c=i.getInstanceCount();n({draw:()=>{this.#t.drawArraysInstanced(this.#t.TRIANGLE_STRIP,0,4,c)}}),this.#t.bindVertexArray(null)}};var ht=null,U=class{#e;#t;constructor(t,r,i){this.#e=t.gl,this.inAttributes={},this.outAttributes={},this.uniforms={},this.#t=this.#i(r,i),this.setAttributesAndUniforms(r,i)}setAttributesAndUniforms(t,r){let i=this.#e.getProgramParameter(this.#t,this.#e.ACTIVE_ATTRIBUTES);for(let o=0;o<i;++o){let a=this.#e.getActiveAttrib(this.#t,o);if(a){let s=a.name;s in t.inAttributes&&(this.inAttributes[s]={location:this.#e.getAttribLocation(this.#t,a.name),type:t.inAttributes[s].type})}}Object.keys(r.outAttributes).forEach(o=>{let a=this.#e.getFragDataLocation(this.#t,o);this.outAttributes[o]={location:a,type:r.outAttributes[o].type}});let n=this.#e.getProgramParameter(this.#t,this.#e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){let a=this.#e.getActiveUniform(this.#t,o);if(a){let s=a.name;(s in t.uniforms||s in r.uniforms)&&(this.uniforms[a.name]={location:this.#e.getUniformLocation(this.#t,a.name),type:t.uniforms[s]||r.uniforms[s]})}}}#i(t,r){let i=this.#e.createProgram(),n=this.#e.createShader(this.#e.VERTEX_SHADER),o=ht?.get(t.name)||t.src;this.#e.shaderSource(n,o),this.#e.compileShader(n);let a="";if(!this.#e.getShaderParameter(n,this.#e.COMPILE_STATUS)){let h=this.#e.getShaderInfoLog(n);h&&(a+=h+`
`)}let s=this.#e.createShader(this.#e.FRAGMENT_SHADER),c=ht?.get(r.name)||r.src;if(this.#e.shaderSource(s,c),this.#e.compileShader(s),!this.#e.getShaderParameter(s,this.#e.COMPILE_STATUS)){let h=this.#e.getShaderInfoLog(s);h&&(a+=h+`
`)}if(this.#e.attachShader(i,n),this.#e.attachShader(i,s),a===""&&(this.#e.linkProgram(i),!this.#e.getProgramParameter(i,this.#e.LINK_STATUS))){let h=this.#e.getProgramInfoLog(i);h&&(a+=`
Linker: (${t.name}, ${r.name}): ${h}`)}if(a!=="")throw new Error(`Shader compilation of [${t.name}, ${r.name}] failed:
${a}`);return i}use(t){this.#e.useProgram(this.#t),t(this),this.#e.useProgram(null)}setUniforms(t){let r=0;for(let i in t){let n=t[i],o=this.uniforms[i];if(o)o.type==="sampler2D"?(this.#e.activeTexture(this.#e[`TEXTURE${r}`]),this.#e.bindTexture(this.#e.TEXTURE_2D,n),this.#e.uniform1i(o.location,r++)):o.type==="float"?this.#e.uniform1f(o.location,n):o.type==="vec2"?this.#e.uniform2fv(o.location,n):o.type==="vec3"?this.#e.uniform3fv(o.location,n):o.type==="vec4"?this.#e.uniform4fv(o.location,n):o.type==="mat2"?this.#e.uniformMatrix2fv(o.location,!1,n):o.type==="mat3"?this.#e.uniformMatrix3fv(o.location,!1,n):o.type==="mat4"?this.#e.uniformMatrix4fv(o.location,!1,n):o.type==="int"&&this.#e.uniform1i(o.location,n);else continue}return this}},N=class{#e;#t;#i;#n;#r=[];constructor(t,r,i){this.#t=t,this.#e=this.#t.createBuffer(),this.#n=0,this.#i=0,this.#r=[];for(let[n,o]of Object.entries(i)){let a=r.inAttributes[n].type;if(a==="float")this.#r.push({col:1,row:1,size:1,name:n,load:(s,c,h)=>{s[c]=o(h)}});else{let s={name:n,load:(c,h,u)=>c.set(o(u),h)};switch(a){case"vec2":this.#r.push({col:1,row:2,size:2,...s});break;case"vec3":this.#r.push({col:1,row:3,size:3,...s});break;case"vec4":this.#r.push({col:1,row:4,size:4,...s});break;case"mat2":this.#r.push({col:2,row:2,size:4,...s});break;case"mat3":this.#r.push({col:3,row:3,size:9,...s});break;case"mat4":this.#r.push({col:4,row:4,size:16,...s});break;default:throw new Error("Unknown instance buffer attribute type")}}this.#i+=this.#r[this.#r.length-1].size}}load(t){this.#n=t.length;let r=new Float32Array(t.length*this.#i),i=0;for(let n=0;n<t.length;++n)for(let o=0;o<this.#r.length;++o)this.#r[o].load(r,i,t[n]),i+=this.#r[o].size;return this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.bufferData(this.#t.ARRAY_BUFFER,r,this.#t.STREAM_DRAW),this.#t.bindBuffer(this.#t.ARRAY_BUFFER,null),this}getInstanceCount(){return this.#n}getAttributesHash(t){return this.#r.map(r=>t.inAttributes[r.name].location).join("-")}bind(t){this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e);let r=0;for(let i=0;i<this.#r.length;++i){let n=t.inAttributes[this.#r[i].name].location;for(let o=0;o<this.#r[i].col;++o)this.#t.enableVertexAttribArray(n+o),this.#t.vertexAttribPointer(n+o,this.#r[i].row,this.#t.FLOAT,!1,this.#i*4,r),this.#t.vertexAttribDivisor(n+o,1),r+=this.#r[i].row*4}return this}},P,q,H,X=class{constructor(t,r,i){oe(this,P,void 0);oe(this,q,void 0);xe(this,P,t),xe(this,q,S(this,P).createFramebuffer()),S(this,P).bindFramebuffer(S(this,P).FRAMEBUFFER,S(this,q));let n=[];Object.entries(i).forEach(([o,a])=>{let s=r.outAttributes[o].location;S(this,P).framebufferTexture2D(S(this,P).FRAMEBUFFER,S(this,P)[`COLOR_ATTACHMENT${s}`],S(this,P).TEXTURE_2D,a,0),n.push(S(this,P)[`COLOR_ATTACHMENT${s}`])}),S(this,P).drawBuffers(n.sort((o,a)=>o-a)),S(this,P).bindFramebuffer(S(this,P).FRAMEBUFFER,null)}bind(t){S(X,H).push(S(this,q)),S(this,P).bindFramebuffer(S(this,P).FRAMEBUFFER,S(this,q)),t(),S(X,H).pop(),S(X,H).length?S(this,P).bindFramebuffer(S(this,P).FRAMEBUFFER,S(X,H)[S(X,H).length-1]):S(this,P).bindFramebuffer(S(this,P).FRAMEBUFFER,null)}},V=X;P=new WeakMap,q=new WeakMap,H=new WeakMap,oe(V,H,[]);function z(e,t,r,i,n,o,a){let s=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a?.wrap||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a?.wrap||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a?.filter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a?.filter||e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,t,n,o,0,r,i,null),e.bindTexture(e.TEXTURE_2D,null),s}var $=R.set(R.create(),0,1,0),K=R.set(R.create(),0,0,1),J=R.cross(R.create(),$,K),_n=d.set(d.create(),$[0],J[0],K[0],$[1],J[1],K[1],$[2],J[2],K[2]),ce=d.transpose(d.create(),_n);var ft;(function(e){})(ft||(ft={}));var Sn={src:`#version 300 es
in vec2 a_position;in mat3 a_uv;in mat3 a_mvp;out vec2 v_texCoord;void main(){vec3 A=a_uv*vec3(a_position,1.);vec3 B=a_mvp*vec3(a_position,1.);v_texCoord=A.xy;gl_Position=vec4(B.xy,0.,1.);}`,name:"deferred-sprite.vert",inAttributes:{a_position:{type:"vec2"},a_uv:{type:"mat3"},a_mvp:{type:"mat3"}},outAttributes:{},uniforms:{}},ut=Sn;var lt;(function(e){})(lt||(lt={}));var wn={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;uniform sampler2D u_diffuseTexture;uniform sampler2D u_normalTexture;uniform sampler2D u_specularTexture;uniform sampler2D u_emissiveTexture;layout(location=0)out vec4 o_normal;layout(location=1)out vec4 o_albedo;layout(location=2)out vec4 o_specular;layout(location=3)out vec4 o_lighting;layout(location=4)out vec4 o_mask;void main(){vec4 A=texture(u_diffuseTexture,v_texCoord);vec3 B=texture(u_normalTexture,v_texCoord).xyz;float C=texture(u_specularTexture,v_texCoord).x;vec3 D=texture(u_emissiveTexture,v_texCoord).xyz;float E=A.w<0.99?0.:1.;o_albedo=vec4(A.xyz*E,E);o_mask=o_albedo;o_normal=vec4(B,E);o_specular=vec4(C,C,C,E);o_lighting=vec4(D,E);}`,name:"deferred-sprite.frag",inAttributes:{},outAttributes:{o_normal:{type:"vec4",location:0},o_albedo:{type:"vec4",location:1},o_specular:{type:"vec4",location:2},o_lighting:{type:"vec4",location:3},o_mask:{type:"vec4",location:4}},uniforms:{u_diffuseTexture:"sampler2D",u_normalTexture:"sampler2D",u_specularTexture:"sampler2D",u_emissiveTexture:"sampler2D"}},mt=wn;var dt;(function(e){})(dt||(dt={}));var En={src:`#version 300 es
in vec2 a_position;in mat3 a_mvp;in mat3 a_uv;in vec3 a_ambient;in vec3 a_diffuse;in vec3 a_direction;in float a_radius;out vec3 v_ambient;out vec3 v_diffuse;out vec3 v_direction;out float v_radius;out vec2 v_texCoord;void main(){vec3 A=a_uv*vec3(a_position,1.);v_texCoord=A.xy;v_ambient=a_ambient;v_diffuse=a_diffuse;v_direction=a_direction;v_radius=a_radius;vec3 B=a_mvp*vec3(a_position,1.);gl_Position=vec4(B.xy,0.,1.);}`,name:"deferred-lighting.vert",inAttributes:{a_position:{type:"vec2"},a_mvp:{type:"mat3"},a_uv:{type:"mat3"},a_ambient:{type:"vec3"},a_diffuse:{type:"vec3"},a_direction:{type:"vec3"},a_radius:{type:"float"}},outAttributes:{},uniforms:{}},pt=En;var ee;(function(r){r[r.LIGHTING_MODE_DIRECTIONAL=0]="LIGHTING_MODE_DIRECTIONAL",r[r.LIGHTING_MODE_POINT=1]="LIGHTING_MODE_POINT"})(ee||(ee={}));var An={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;in vec3 v_ambient;in vec3 v_diffuse;in vec3 v_direction;in float v_radius;uniform vec3 u_viewDirection;uniform int u_lightingMode;uniform sampler2D u_albedoTexture;uniform sampler2D u_normalTexture;uniform sampler2D u_specularTexture;uniform mat3 u_toTangentSpace;const int A=0;const int B=1;const float C=2.;const float D=32.;layout(location=0)out vec4 o_lighting;void main(){vec3 E=normalize(texture(u_normalTexture,v_texCoord).rgb*2.-1.);vec3 F=texture(u_albedoTexture,v_texCoord).rgb;vec3 G=texture(u_specularTexture,v_texCoord).rgb;vec3 H=v_ambient*F;vec3 I=u_lightingMode==A?v_direction:vec3(v_texCoord,0.)-v_direction;I.y*=u_lightingMode==A?1.:-1.;float J=u_lightingMode==A?1.:pow(1.-min(v_radius,length(I))/v_radius,C);vec3 K=normalize(I*-1.)*u_toTangentSpace;float L=max(dot(E,K),0.);vec3 M=F*v_diffuse*L*J;vec3 N=normalize(K+(u_viewDirection*-1.*u_toTangentSpace));float O=max(dot(E,N),0.);float P=pow(O,D);vec3 Q=v_diffuse*P*G*J;o_lighting=vec4(H+M+Q,1.);}`,name:"deferred-lighting.frag",inAttributes:{},outAttributes:{o_lighting:{type:"vec4",location:0}},uniforms:{u_viewDirection:"vec3",u_lightingMode:"int",u_albedoTexture:"sampler2D",u_normalTexture:"sampler2D",u_specularTexture:"sampler2D",u_toTangentSpace:"mat3"}},vt=An;var ye=class extends se{},Mn=R.fromValues(0,0,0),te=d.create();d.scale(te,te,[1,-1]);d.mul(te,te,O);var re=d.create();d.translate(re,re,[0,0]);d.scale(re,re,[1,1]);async function Te(e,t){let[r,i,n,o]=await Promise.all([W(e,t.urls.diffuse),W(e,t.urls.normal),W(e,t.urls.specular),W(e,t.urls.emissive)]);return{diffuseTexture:r,normalTexture:i,specularTexture:n,emissiveTexture:o}}var _e=class{#e;#t;#i;#n;#r;#o;#a;#c;#s;#f;#h;#u;#l;constructor(t){this.#e=t.gl,this.#t=new U(t,ut,mt),this.#i=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_uv:r=>r.uv}),this.#n=[],this.#r=new U(t,pt,vt),this.#o=new N(this.#e,this.#r,{a_mvp:r=>r.mvp,a_uv:r=>r.uv,a_ambient:r=>r.ambient,a_diffuse:r=>r.diffuse,a_direction:r=>r.direction,a_radius:r=>r.radius}),this.#a=[],this.#c=[],this.#f=new F(this.#e),this.#s=null,this.#h=null,this.#u=this.#l=0}use(t,r,i){if(!this.#h||t.width!==this.#u||t.height!==this.#l){this.#l=t.height,this.#u=t.width;let o={normal:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),albedo:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),specular:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),lighting:{[w]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height},mask:{[w]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height}};this.#h={...o,maskFrameBuffer:new V(this.#e,this.#t,{o_normal:o.normal,o_albedo:o.albedo,o_specular:o.specular,o_lighting:o.lighting[w],o_mask:o.mask[w]}),noMaskFrameBuffer:new V(this.#e,this.#t,{o_normal:o.normal,o_albedo:o.albedo,o_specular:o.specular,o_lighting:o.lighting[w],o_mask:null}),lightingFrameBuffer:new V(this.#e,this.#r,{o_lighting:o.lighting[w]})}}let n=this.#h;n.maskFrameBuffer.bind(()=>{this.#e.viewport(0,0,this.#u,this.#l),this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#t.use(()=>{r(this,0),this.#m()})}),n.noMaskFrameBuffer.bind(()=>{i(n.mask),this.#t.use(()=>{r(this,1),this.#m()})}),n.lightingFrameBuffer.bind(()=>{let o=this.#e.getParameter(this.#e.BLEND),a=this.#e.getParameter(this.#e.BLEND_SRC_ALPHA),s=this.#e.getParameter(this.#e.BLEND_DST_ALPHA);this.#e.enable(this.#e.BLEND),this.#e.blendFunc(this.#e.ONE,this.#e.ONE),this.#r.use(c=>{c.setUniforms({u_albedoTexture:n.albedo,u_normalTexture:n.normal,u_specularTexture:n.specular,u_toTangentSpace:ce,u_viewDirection:R.fromValues(0,0,-1)}),this.#a.length&&(c.setUniforms({u_lightingMode:ee.LIGHTING_MODE_DIRECTIONAL}),this.#f.bindInstances(c,{position:"a_position"},this.#o.load(this.#a),h=>h.draw()),this.#a.length=0),this.#c.length&&(c.setUniforms({u_lightingMode:ee.LIGHTING_MODE_POINT}),this.#f.bindInstances(c,{position:"a_position"},this.#o.load(this.#c),h=>h.draw()),this.#c.length=0)}),o||this.#e.disable(this.#e.BLEND),this.#e.blendFunc(a,s)})}addDirectionalLight(t){return this.#a.push({mvp:te,uv:re,ambient:t.ambient,diffuse:t.diffuse,direction:t.direction,radius:0}),this}addPointLight(t){if(t.position[2]>=t.radius)return this;let r=Math.sqrt(t.radius*t.radius-t.position[2]*t.position[2]),i=d.create();d.translate(i,i,[t.position[0]-r,t.position[1]-r]),d.scale(i,i,[r*2,r*2]),d.mul(i,O,i);let n=d.create();return d.translate(n,n,[t.position[0]-r,1-t.position[1]+r]),d.scale(n,n,[r*2,r*2]),d.scale(n,n,[1,-1]),this.#c.push({mvp:i,uv:n,ambient:Mn,diffuse:t.diffuse,direction:R.fromValues(t.position[0],1-t.position[1],t.position[2]),radius:t.radius}),this}getLightingTexture(){return this.#h?.lighting}setTextures(t){return t===this.#s?this:(this.#n.length&&this.#m(),this.#s=t,this.#t.setUniforms({u_diffuseTexture:t.diffuseTexture[w],u_normalTexture:t.normalTexture[w],u_specularTexture:t.specularTexture[w],u_emissiveTexture:t.emissiveTexture[w]}),this)}draw(t,r){if(this.#s){let i=d.create();d.translate(i,i,[t[3],t[0]]),d.scale(i,i,[t[1]-t[3],t[2]-t[0]]),d.multiply(i,O,i);let n=d.create();d.translate(n,n,[r[3]/this.#s.diffuseTexture.width,r[0]/this.#s.diffuseTexture.height]),d.scale(n,n,[(r[1]-r[3])/this.#s.diffuseTexture.width,(r[2]-r[0])/this.#s.diffuseTexture.height]),this.#n.push({mvp:i,uv:n})}return this}#m(){!this.#n.length||(this.#f.bindInstances(this.#t,{position:"a_position"},this.#i.load(this.#n),t=>t.draw()),this.#n.length=0,this.#s=null)}};var gt;(function(e){})(gt||(gt={}));var Rn={src:`#version 300 es
in vec2 a_position;in mat3 a_uv;in mat3 a_mvp;in float a_alpha;out vec2 v_texCoord;out float v_alpha;void main(){vec3 A=a_uv*vec3(a_position,1.);vec3 B=a_mvp*vec3(a_position,1.);v_alpha=a_alpha;v_texCoord=A.xy;gl_Position=vec4(B.xy,0.,1.);}`,name:"sprite.vert",inAttributes:{a_position:{type:"vec2"},a_uv:{type:"mat3"},a_mvp:{type:"mat3"},a_alpha:{type:"float"}},outAttributes:{},uniforms:{}},xt=Rn;var bt;(function(e){})(bt||(bt={}));var Pn={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;in float v_alpha;uniform sampler2D u_texture;out vec4 outColor;void main(){outColor=texture(u_texture,v_texCoord);outColor.a*=v_alpha;}`,name:"sprite.frag",inAttributes:{},outAttributes:{outColor:{type:"vec4"}},uniforms:{u_texture:"sampler2D"}},yt=Pn;async function Tt(e,t){return await W(e,t.urls.diffuse)}var Se=class{#e;#t;#i;#n;#r;#o;#a;constructor(t){this.#e=t.gl,this.#t=new U(t,xt,yt),this.#i=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_uv:r=>r.uv,a_alpha:r=>r.alpha}),this.#n=new F(this.#e),this.#o=[],this.#r=null,this.#a=1}use(t){this.#t.use(()=>{this.#a=1,t(this),this.#c()})}setTextures(t){return t===this.#r?this:(this.#o.length&&this.#c(),this.#r=t,this.#t.setUniforms({u_texture:t[w]}),this)}setAlpha(t){return this.#a=t,this}draw(t,r){if(this.#r){let i=d.create();d.translate(i,i,[t[3],t[0]]),d.scale(i,i,[t[1]-t[3],t[2]-t[0]]),d.multiply(i,O,i);let n=d.create();d.translate(n,n,[r[3]/this.#r.width,r[0]/this.#r.height]),d.scale(n,n,[(r[1]-r[3])/this.#r.width,(r[2]-r[0])/this.#r.height]),this.#o.push({mvp:i,uv:n,alpha:this.#a})}return this}#c(){this.#n.bindInstances(this.#t,{position:"a_position"},this.#i.load(this.#o),t=>{t.draw()}),this.#o=[],this.#r=null}};var _t;(function(e){})(_t||(_t={}));var In={src:`#version 300 es
in vec2 a_position;out vec2 v_texCoord;void main(){v_texCoord=a_position;gl_Position=vec4(a_position*2.-1.,0.,1.);}`,name:"quad.vert",inAttributes:{a_position:{type:"vec2"}},outAttributes:{},uniforms:{}},he=In;var St;(function(t){t[t.nwaves=12]="nwaves"})(St||(St={}));var Ln={src:`#version 300 es
precision mediump float;layout(location=0)out vec4 o_normal;layout(location=1)out vec4 o_albedo;layout(location=2)out vec4 o_specular;layout(location=3)out vec4 o_lighting;layout(location=4)out vec4 o_mask;in vec2 v_texCoord;uniform sampler2D u_mask;uniform sampler2D u_depth;uniform float u_time;uniform vec2 u_offset;uniform vec3 u_normal;uniform vec3 u_tangent;uniform vec3 u_binormal;uniform mat3 u_toTangentSpace;const float A=acos(-1.);const vec2 B=vec2(1.,0.);const int C=12;const float D=1000.;float E(vec2 F){return fract(sin(dot(F.xy,vec2(12.9898,78.233)))*43758.5453);}void G(in int H,out float I,out float J,out vec2 K,out float L,out float M){I=abs(0.05*E(vec2(H,H)));J=.02+.01*E(vec2(float(H+5)));K=(vec2(E(vec2(H,H+1)),E(vec2(H-2,H+2))));L=30.+82.*E(vec2(float(H+5)));M=(2.5+4.2*E(vec2(float(H+4))))*0.00045;}float N(float O){return round(O*D)/D;}void P(in vec2 Q,in float R,in float S,out vec3 T,out vec3 U){T=vec3(Q,0.);U=B.yyy;float I,L,M,J;vec2 K;for(int H=0;H<C;++H){G(H,I,J,K,L,M);I+=R*0.1;J+=R*0.3;float V=dot(K,Q);T+=vec3(I*J*K*cos(L*V+N(M)*S*A*2.),J*sin(L*V+N(M)*S*A*2.));}for(int H=0;H<C;++H){G(H,I,J,K,L,M);U+=vec3(-K*L*J*cos(L*dot(K,T.xy)+N(M)*S*A*2.),1.-I*L*J*sin(L*dot(K,T.xy)+N(M)*S*A*2.));}U=normalize(U);}void main(){vec4 W=texture(u_mask,v_texCoord);vec4 X=texture(u_depth,v_texCoord);float R=smoothstep(0.,1.,X.a);float Y=1.-W.a;vec3 Z=B.yyx,a=1.*B.xyy,b=1.*B.yxy+B.yyx,V=normalize(cross(b,a)),c=Z+(v_texCoord.x+u_offset.x)*a+(v_texCoord.y-u_offset.y)*b;vec3 d=(B.yyx-3.*B.yxy),e=mat3(B.yxy,B.yyx,1./V.z,-V.x/V.z,-V.y/V.z)*c,f,T;P(e.xy,R,u_time,T,f);vec3 g=normalize(cross(f.x*u_normal+u_binormal,f.y*u_normal+u_tangent))*u_toTangentSpace;o_albedo=vec4(50./255.+R*0.5,124./255.+R*0.5,T.z/255.+224./255.+R,Y);if(R<0.99){vec4 h=texture(u_depth,v_texCoord-f.xy*4.);if(h.r>0.001){o_albedo=vec4(h.rgb*R/2.+o_albedo.rgb*(1.-R/2.),Y);}}o_normal=vec4(g,Y);o_specular=vec4(1.,1.,1.,Y);o_lighting=vec4(0.,0.,0.,0.);o_mask=vec4(0.,0.,0.,0.);}`,name:"water.frag",inAttributes:{},outAttributes:{o_normal:{type:"vec4",location:0},o_albedo:{type:"vec4",location:1},o_specular:{type:"vec4",location:2},o_lighting:{type:"vec4",location:3},o_mask:{type:"vec4",location:4}},uniforms:{u_mask:"sampler2D",u_depth:"sampler2D",u_time:"float",u_offset:"vec2",u_normal:"vec3",u_tangent:"vec3",u_binormal:"vec3",u_toTangentSpace:"mat3"}},wt=Ln;var we=class{#e;#t;#i;constructor(t){this.#e=t.gl,this.#t=new U(t,he,wt),this.#i=new F(this.#e)}draw(t,r,i,n){return this.#t.use(o=>{o.setUniforms({u_normal:K,u_tangent:$,u_binormal:J,u_toTangentSpace:ce,u_time:t,u_offset:r,u_mask:i[w],u_depth:n[w]}),this.#i.bind(this.#t,{position:"a_position"},a=>{a.draw()})}),this}};var Et;(function(t){t[t.offset=16]="offset"})(Et||(Et={}));var Dn={src:`#version 300 es
precision mediump float;uniform sampler2D u_blur;uniform vec2 u_blurSize;uniform vec2 u_blurDirection;uniform float u_blurStrength;in vec2 v_texCoord;out vec4 o_color;const int A=16;void main(){float B=texture(u_blur,v_texCoord).a;vec3 C=vec3(0.);for(int D=0;D<A;++D){vec2 E=v_texCoord+((vec2(-D,-D)*u_blurDirection)/u_blurSize);vec4 F=texture(u_blur,E);float G=F.a*pow(float(A-D)/float(A),u_blurStrength);B=max(B,G);C=length(C)<length(F.rgb)?F.rgb:C;vec2 H=v_texCoord+((vec2(D,D)*u_blurDirection)/u_blurSize);vec4 I=texture(u_blur,H);float J=I.a*pow(float(A-D)/float(A),u_blurStrength);B=max(B,J);C=length(C)<length(I.rgb)?I.rgb:C;}o_color=vec4(C,B);}`,name:"nearest-blur.frag",inAttributes:{},outAttributes:{o_color:{type:"vec4"}},uniforms:{u_blur:"sampler2D",u_blurSize:"vec2",u_blurDirection:"vec2",u_blurStrength:"float"}},At=Dn;var Ee=class{#e;#t;#i;#n;constructor(t){this.#e=t.gl,this.#t=new U(t,he,At),this.#i=new F(this.#e),this.#n=null}draw(t,r){if(!this.#n||this.#n.textures[0].width!==t.width||this.#n.textures[0].height!==t.height){let o=[];for(let a=0;a<2;a++)o.push({[w]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height});this.#n={textures:o,frameBuffers:[new V(this.#e,this.#t,{o_color:o[0][w]}),new V(this.#e,this.#t,{o_color:o[1][w]})]}}let i=this.#e.getParameter(this.#e.BLEND);this.#e.disable(this.#e.BLEND);let n=this.#n;return this.#t.use(o=>{this.#e.viewport(0,0,t.width,t.height),o.setUniforms({u_blur:t[w],u_blurSize:[t.width,t.height],u_blurDirection:[0,1],u_blurStrength:r}),n.frameBuffers[0].bind(()=>{this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#i.bind(this.#t,{position:"a_position"},a=>{a.draw()})}),o.setUniforms({u_blur:n.textures[0][w],u_blurSize:[n.textures[0].width,n.textures[0].height],u_blurDirection:[1,0]}),n.frameBuffers[1].bind(()=>{this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#i.bind(this.#t,{position:"a_position"},a=>{a.draw()})}),this.#e.viewport(0,0,t.width,t.height)}),i&&this.#e.enable(this.#e.BLEND),this}getBlurTexture(){return this.#n.textures[1]}};var Mt;(function(e){})(Mt||(Mt={}));var Cn={src:`#version 300 es
in vec2 a_position;in vec4 a_color;in mat3 a_mvp;out vec4 v_color;void main(){v_color=a_color;vec3 A=a_mvp*vec3(a_position,1.);gl_Position=vec4(A.xy,0.,1.);}`,name:"solid.vert",inAttributes:{a_position:{type:"vec2"},a_color:{type:"vec4"},a_mvp:{type:"mat3"}},outAttributes:{},uniforms:{}},Rt=Cn;var Pt;(function(e){})(Pt||(Pt={}));var Un={src:`#version 300 es
precision mediump float;in vec4 v_color;out vec4 outColor;void main(){outColor=v_color;}`,name:"solid.frag",inAttributes:{},outAttributes:{outColor:{type:"vec4"}},uniforms:{}},It=Un;var Ae=class{#e;#t;#i;#n;#r;constructor(t){this.#e=t.gl,this.#t=new U(t,Rt,It),this.#i=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_color:r=>r.color}),this.#n=new F(this.#e),this.#r=[]}use(t){this.#t.use(()=>{t(this),this.#o()})}draw(t,r){let i=d.create();return d.translate(i,i,[t[3],t[0]]),d.scale(i,i,[t[1]-t[3],t[2]-t[0]]),d.multiply(i,O,i),this.#r.push({mvp:i,color:r}),this}#o(){this.#n.bindInstances(this.#t,{position:"a_position"},this.#i.load(this.#r),t=>t.draw()),this.#r=[]}};var Bn={name:"overworld",sprites:{grass_b:{index:1,width:16,height:16,frames:[{top:0,left:0,bottom:16,right:16}]},grass_bl:{index:2,width:16,height:16,frames:[{top:16,left:0,bottom:32,right:16}]},grass_br:{index:3,width:16,height:16,frames:[{top:32,left:0,bottom:48,right:16}]},grass_i_bl:{index:4,width:16,height:16,frames:[{top:48,left:0,bottom:64,right:16}]},grass_i_br:{index:5,width:16,height:16,frames:[{top:64,left:0,bottom:80,right:16}]},grass_t:{index:6,width:16,height:16,frames:[{top:80,left:0,bottom:96,right:16}]},grass_tl:{index:7,width:16,height:16,frames:[{top:96,left:0,bottom:112,right:16}]},grass_tr:{index:8,width:16,height:16,frames:[{top:112,left:0,bottom:128,right:16}]},grass_i_tl:{index:9,width:16,height:16,frames:[{top:128,left:0,bottom:144,right:16}]},grass_i_tr:{index:10,width:16,height:16,frames:[{top:144,left:0,bottom:160,right:16}]},grass_l:{index:11,width:16,height:16,frames:[{top:160,left:0,bottom:176,right:16}]},grass_r:{index:12,width:16,height:16,frames:[{top:176,left:0,bottom:192,right:16}]},grass:{index:13,width:16,height:16,frames:[{top:192,left:0,bottom:208,right:16},{top:192,left:16,bottom:208,right:32},{top:192,left:32,bottom:208,right:48},{top:192,left:48,bottom:208,right:64}]},water:{index:14,width:16,height:16,frames:[{top:208,left:0,bottom:224,right:16},{top:208,left:16,bottom:224,right:32},{top:208,left:32,bottom:224,right:48},{top:208,left:48,bottom:224,right:64},{top:208,left:64,bottom:224,right:80},{top:208,left:80,bottom:224,right:96},{top:208,left:96,bottom:224,right:112},{top:208,left:112,bottom:224,right:128}]}},indexes:["","grass_b","grass_bl","grass_br","grass_i_bl","grass_i_br","grass_t","grass_tl","grass_tr","grass_i_tl","grass_i_tr","grass_l","grass_r","grass","water"],urls:{diffuse:"/sprites/overworld-diffuse.png?v=ea02439ea304fa9e0d848d7912c7d7d15b925fc407375d8640c4f34f53488b59",emissive:"/sprites/overworld-emissive.png?v=7e964b09ced6bc0c687bf7ecdb19a52cb3292c73da1ab2b7ef5d5a58b36ddfaa",normal:"/sprites/overworld-normal.png?v=0505155085fd370a373a67399716ed59767af6c1bc2e2d510569b68d836b286a",specular:"/sprites/overworld-specular.png?v=55f7d8c380b7ae96744f2a603c471cac28960f274676126a554b1600db787175"}},Lt=Bn;var Fn={width:100,height:100,startPosition:{x:10,y:10},spriteSheet:"overworld",url:"/maps/overworld.png?v=e4bdd99e6d063d64d88565a32ca2dd26fa1f3588f12b6eccf6a414db19f73224",spriteSheet:Lt},B=Fn;var Gn={name:"character",sprites:{walk_d:{index:1,width:16,height:32,frames:[{top:0,left:0,bottom:32,right:16},{top:0,left:16,bottom:32,right:32},{top:0,left:32,bottom:32,right:48},{top:0,left:48,bottom:32,right:64}]},walk_u:{index:2,width:16,height:32,frames:[{top:32,left:0,bottom:64,right:16},{top:32,left:16,bottom:64,right:32},{top:32,left:32,bottom:64,right:48},{top:32,left:48,bottom:64,right:64}]},walk_l:{index:3,width:16,height:32,frames:[{top:64,left:0,bottom:96,right:16},{top:64,left:16,bottom:96,right:32},{top:64,left:32,bottom:96,right:48},{top:64,left:48,bottom:96,right:64}]},walk_r:{index:4,width:16,height:32,frames:[{top:96,left:0,bottom:128,right:16},{top:96,left:16,bottom:128,right:32},{top:96,left:32,bottom:128,right:48},{top:96,left:48,bottom:128,right:64}]}},indexes:["","walk_d","walk_u","walk_l","walk_r"],urls:{diffuse:"/sprites/character-diffuse.png?v=9f00a75a66e129cec549aa5a71a0299b95836a14d7e9cb3829128e3af40c5ced",emissive:"/sprites/character-emissive.png?v=269513c7efa74adea87bfedc176d2edce2df1c754a8fbcc31665f1a9a0238bf0",normal:"/sprites/character-normal.png?v=4d73d74cb4bd80a94e31caf56877ea254b3f4c08ecd24b593df0cd693bced45e",specular:"/sprites/character-specular.png?v=a96da987d48f9677939e8a0127a29912b247d8bded2cc42d28b867e3bff8f398"}},Dt=Gn;var kn={name:"ui",sprites:{touch:{index:1,width:64,height:64,frames:[{top:0,left:0,bottom:64,right:64}]}},indexes:["","touch"],urls:{diffuse:"/sprites/ui-diffuse.png?v=4edaa65c0c8da93ba283fb9dfa8fc44c6cd7a4238aa81e48175c702eac0a703e",emissive:"/sprites/ui-emissive.png?v=ebb17149ce1cf937cadfb8e903b2812b9a0ecc366eb7705e40e3c73461dc082f",normal:"/sprites/ui-normal.png?v=fab0d72f495130a5aab540c29aee75180b94f27cdbf5c5a0b806feb39a148b59",specular:"/sprites/ui-specular.png?v=01c6ec306f27fa4865bd1f3105fca42b0b9da17a429013e82bf32f1bf88a1944"}},Ct=kn;var g=16;function Vn(e,t,r){return b.add(e,t,r.absolutePosition)}function ie(e,t){return y.set(e,Math.floor(t[0]/g),Math.floor(t[1]/g),Math.floor(t[0])%g,Math.floor(t[1])%g)}function Me(e,t,r){let i=b.create();return Vn(i,t,r),y.set(e,Math.floor(i[0]/g),Math.floor(i[1]/g),Math.floor(i[0])%g,Math.floor(i[1])%g)}function Ut(e,t,r){return On(e,t,r),r.toScreenSpace(e,Nn(e,e))}function On(e,t,r){let i=ie(y.create(),r.absolutePosition);return y.set(e,t[0]-i[0],t[1]-i[1],i[2],i[3])}function Nn(e,t,r=1){return y.set(e,t[1]*g-t[3],t[0]*g+g*r-t[2],t[1]*g+g*r-t[3],t[0]*g-t[2])}function Re(e,t){return{index:e[t],triggerId:e[t+1],walkable:(e[t+2]&1)==1,spatialHash:(e[t+2]&2)==2,animated:(e[t+2]&4)==4}}function Pe(e,t,r){e[t]=r.index,e[t+1]=r.triggerId,e[t+2]=(r.walkable?1:0)|(r.spatialHash?2:0)|(r.animated?4:0)}var fe=class{constructor(t,r,i){this.offscreen=t.createOffscreenCanvas(i.width,i.height,{willReadFrequently:!0}),this.offscreen.drawImage(i.image,0,0,i.width,i.height),this.width=i.width,this.height=i.height,this.tileSize=r,this.buffer=new ImageData(t.screen.width/r+3,t.screen.height/r+3),this.bufferPosition=y.create(),this.lastScreenPosition=b.create(),this.lastScreenWidth=0,this.lastScreenHeight=0}updateScreenBuffer(t,r){if(this.lastScreenWidth!==t.screen.width||this.lastScreenHeight!==t.screen.height||this.lastScreenPosition[0]!==r[0]||this.lastScreenPosition[1]!==r[1]){let i=ie(y.create(),r);this.bufferPosition=y.fromValues(i[0]-1,i[1]-1,t.screen.width/this.tileSize+3,t.screen.height/this.tileSize+3),this.buffer=this.offscreen.getImageData(this.bufferPosition[0],this.bufferPosition[1],this.bufferPosition[2],this.bufferPosition[3]),this.lastScreenPosition=b.clone(r),this.lastScreenWidth=t.screen.width,this.lastScreenHeight=t.screen.height}}read(t,r){if(t>=this.bufferPosition[0]&&t<this.bufferPosition[0]+this.bufferPosition[2]&&r>=this.bufferPosition[1]&&r<this.bufferPosition[1]+this.bufferPosition[3]){t-=this.bufferPosition[0],r-=this.bufferPosition[1];let i=4*(this.buffer.width*r+t);return Re(this.buffer.data,i)}else{let i=this.offscreen.getImageData(t,r,1,1);return Re(i.data,0)}}write(t,r,i){if(t>=this.bufferPosition[0]&&t<this.bufferPosition[0]+this.bufferPosition[2]&&r>=this.bufferPosition[1]&&r<this.bufferPosition[1]+this.bufferPosition[3]){t-=this.bufferPosition[0],r-=this.bufferPosition[1];let n=4*(this.buffer.width*r+t);Pe(this.buffer.data,n,i),this.offscreen.putImageData(this.buffer,this.bufferPosition[0],this.bufferPosition[1])}else{let n=new ImageData(1,1);Pe(n.data,0,i),this.offscreen.putImageData(n,t,r)}}};var ue=.25,le=5,Bt=2,k=1e3;function Ft(e){return{version:Bt,character:{position:[e.character.position[0],e.character.position[1]],direction:e.character.animator.getSpriteName()}}}async function Gt(e,t){if(t&&t.version!==Bt)throw new Error(`Invalid save version ${t.version}`);let r=await ae(e,B.spriteSheet,Te),i=await ae(e,Dt,Te),n=await at(e,B.url),o={spriteEffect:new _e(e),simpleSpriteEffect:new Se(e),solidEffect:new Ae(e),map:new fe(e,g,n),ui:await ae(e,Ct,Tt),overworld:r,character:{sprite:i,animator:new ye(i,t?t.character.direction:"walk_d",8/1e3),position:t?b.fromValues(t.character.position[0],t.character.position[1]):b.fromValues(B.startPosition.x*g,B.startPosition.y*g),relativePosition:b.create(),boundingBox:y.fromValues(i.walk_u.height-14,i.walk_u.width-2,i.walk_u.height-4,2),speed:1},waterEffect:new we(e),blurEffect:new Ee(e),animationTimer:0,screen:{absolutePosition:b.create()},moveTouch:null};return e.editor&&(o.editor={active:!1,newValue:null,pendingChanges:new Map}),o}function kt(e,t,r){let i={},n=e.getGamepad();n&&((n.buttons[12].pressed||Math.min(0,n.axes[1]+ue)<0)&&(i.up=!0),(n.buttons[13].pressed||Math.max(0,n.axes[1]-ue)>0)&&(i.down=!0),(n.buttons[14].pressed||Math.min(0,n.axes[0]+ue)<0)&&(i.left=!0),(n.buttons[15].pressed||Math.max(0,n.axes[0]-ue)>0)&&(i.right=!0)),e.keys.pressed.has("f")&&e.keys.down.has("Control")&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():e.canvas.requestFullscreen()),(e.keys.down.has("w")||e.keys.down.has("ArrowUp"))&&(i.up=!0),(e.keys.down.has("s")||e.keys.down.has("ArrowDown"))&&(i.down=!0),(e.keys.down.has("a")||e.keys.down.has("ArrowLeft"))&&(i.left=!0),(e.keys.down.has("d")||e.keys.down.has("ArrowRight"))&&(i.right=!0);for(let[h,u]of e.touches.down)t.moveTouch===null&&Date.now()-u.started>250&&(t.moveTouch={id:h,startPosition:b.clone(u.position)});for(let[h,u]of e.touches.ended)t.moveTouch!==null&&h===t.moveTouch.id&&(t.moveTouch=null);if(t.moveTouch!==null){let h=e.touches.down.get(t.moveTouch.id);h?(h.position[0]-t.moveTouch.startPosition[0]<-le&&(i.left=!0),h.position[0]-t.moveTouch.startPosition[0]>le&&(i.right=!0),h.position[1]-t.moveTouch.startPosition[1]<-le&&(i.up=!0),h.position[1]-t.moveTouch.startPosition[1]>le&&(i.down=!0)):t.moveTouch=null}let o=null;i.left?o="walk_l":i.right?o="walk_r":i.up?o="walk_u":i.down&&(o="walk_d"),o&&t.character.animator.setSpriteOrTick(o,r),t.animationTimer+=r/10,t.animationTimer>k&&(t.animationTimer-=k);let a=b.create();i.left&&a[0]--,i.right&&a[0]++,i.up&&a[1]--,i.down&&a[1]++,b.normalize(a,a),b.scale(a,a,t.character.speed),b.add(a,a,t.character.position);let s=b.fromValues(t.character.animator.getSprite().width/2,t.character.animator.getSprite().height/2);if(t.map.read(Math.floor((a[0]-s[0]+t.character.boundingBox[3])/g),Math.floor((a[1]-s[1]+t.character.boundingBox[0])/g)).walkable&&t.map.read(Math.floor((a[0]-s[0]+t.character.boundingBox[1])/g),Math.floor((a[1]-s[1]+t.character.boundingBox[0])/g)).walkable&&t.map.read(Math.floor((a[0]-s[0]+t.character.boundingBox[3])/g),Math.floor((a[1]-s[1]+t.character.boundingBox[2])/g)).walkable&&t.map.read(Math.floor((a[0]-s[0]+t.character.boundingBox[1])/g),Math.floor((a[1]-s[1]+t.character.boundingBox[2])/g)).walkable){let h=b.fromValues(t.character.animator.getSprite().width/2,t.character.animator.getSprite().height/2),u=b.fromValues(t.map.width*g,t.map.height*g);b.subtract(u,u,h),b.min(t.character.position,a,u),b.max(t.character.position,t.character.position,h)}t.character.relativePosition[0]=t.character.position[0]<e.screen.width/2?t.character.position[0]:t.character.position[0]>t.map.width*g-e.screen.width/2?t.character.position[0]-t.map.width*g+e.screen.width:e.screen.width/2,t.character.relativePosition[1]=t.character.position[1]<e.screen.height/2?t.character.position[1]:t.character.position[1]>t.map.height*g-e.screen.height/2?t.character.position[1]-t.map.height*g+e.screen.height:e.screen.height/2,b.subtract(t.screen.absolutePosition,t.character.position,t.character.relativePosition),t.map.updateScreenBuffer(e,t.screen.absolutePosition),e.editor&&zn(e,t,r)}function Vt(e,t,r){return r=Math.max(0,Math.min(1,(r-e)/(t-e))),r*r*(3-2*r)}function Ot(e,t,r){e.gl.enable(e.gl.BLEND),e.gl.blendFunc(e.gl.SRC_ALPHA,e.gl.ONE_MINUS_SRC_ALPHA);let i=ie(y.create(),t.screen.absolutePosition),n=Math.sin(t.animationTimer);n=Math.min(1,n+.5);let o=t.animationTimer<k*.25?Vt(0,k*.25,t.animationTimer):t.animationTimer<k*.5?1:t.animationTimer<k*.75?1-Vt(k*.5,k*.75,t.animationTimer):0,a=Math.cos(Math.min(t.animationTimer,k*.75)*Math.PI/(k*.75));t.spriteEffect.addDirectionalLight({ambient:R.fromValues(.2+o*.3,.2+o*.3,.4+o*.1),direction:R.fromValues(a,o*.3+.2,-1),diffuse:R.fromValues(Math.pow(o,.25)*(1-o)+o*.5,o*.5,o*.45)}).addDirectionalLight({ambient:R.create(),direction:R.fromValues(0,(1-o)*.5,-1),diffuse:R.fromValues((1-o)*.2,(1-o)*.2,(1-o)*.2)}).addPointLight({diffuse:R.fromValues(.6*(1-o),.6*(1-o),.3*(1-o)),position:R.fromValues(e.mouse.position[0]/e.screen.width,e.mouse.position[1]/e.screen.height,.1),radius:.5}).use({width:e.screen.width,height:e.screen.height},(s,c)=>{if(c===0)for(let h=-1;h<=(e.screen.width+2)/g;++h)for(let u=-1;u<=(e.screen.height+2)/g;++u){let m=h+i[0],l=u+i[1],p=e.screen.toScreenSpace(y.create(),y.fromValues(u*g-i[3],h*g+g-i[2],u*g+g-i[3],h*g-i[2])),x=t.map.read(m,l);if(x.index!==0){let E=B.spriteSheet.indexes[x.index];t.overworld[E].draw(s,p,x.spatialHash?Yn(m,l):void 0)}}else{let h=b.fromValues(t.character.animator.getSprite().width/2,t.character.animator.getSprite().height/2);t.character.animator.draw(s,e.screen.toScreenSpace(y.create(),y.fromValues(Math.floor(t.character.relativePosition[1])-h[1],Math.floor(t.character.relativePosition[0])+h[0],Math.floor(t.character.relativePosition[1])+h[1],Math.floor(t.character.relativePosition[0])-h[0])))}},s=>{let c=b.clone(t.screen.absolutePosition);b.div(c,c,b.fromValues(e.screen.width,e.screen.height)),t.blurEffect.draw(s,3),t.waterEffect.draw(t.animationTimer,c,s,t.blurEffect.getBlurTexture())}),t.simpleSpriteEffect.use(s=>{let c=t.spriteEffect.getLightingTexture();c&&(s.setTextures(c),s.draw(y.fromValues(1,1,0,0),y.fromValues(0,c.width,c.height,0))),t.moveTouch!==null&&(s.setAlpha(.5),t.ui.touch.draw(s,e.screen.toScreenSpace(y.create(),y.fromValues(Math.round(t.moveTouch.startPosition[1])-32,Math.round(t.moveTouch.startPosition[0])+32,Math.round(t.moveTouch.startPosition[1])+32,Math.round(t.moveTouch.startPosition[0])-32))))}),e.editor&&Wn(e,t,r)}var D=new Set;D.add("tl");D.add("tr");D.add("bl");D.add("br");D.add("t");D.add("b");D.add("l");D.add("r");D.add("i_tl");D.add("i_tr");D.add("i_bl");D.add("i_br");function zn(e,t,r){if(!!t.editor&&(e.keys.pressed.has("m")&&e.keys.down.has("Control")&&(t.editor.active=!t.editor.active),!!t.editor.active))if(e.mouse.down[0]){let i=Me(y.create(),e.mouse.position,t.screen);if(t.editor.newValue===null){let n=t.map.read(i[0],i[1]),o=B.spriteSheet.indexes[n.index];t.editor.newValue=o===""?"grass":""}Hn(t,{sprite:t.editor.newValue,x:i[0],y:i[1]})}else{t.editor.newValue=null;for(let i of t.editor.pendingChanges.values())e.editor?.sendAction(i);t.editor.pendingChanges.clear()}}function Hn(e,t){Ie(e,t);let r=new Array;for(let n=-1;n<=1;++n)for(let o=-1;o<=1;++o){let a=e.map.read(t.x+n,t.y+o),s=B.spriteSheet.indexes[a.index],c=s.indexOf("_");if(c!==-1){let h=s.substring(0,c),u=s.substring(c+1);if(B.spriteSheet.sprites.hasOwnProperty(h)&&D.has(u)){let m=B.spriteSheet.sprites[h].index;a.index=m,Ie(e,{sprite:h,x:t.x+n,y:t.y+o}),r.push({x:t.x+n,y:t.y+o,sprite:h})}}else r.push({x:t.x+n,y:t.y+o,sprite:s})}let i=Array();for(let n of r){let o=e.map.read(n.x,n.y-1).index===0,a=e.map.read(n.x-1,n.y).index===0,s=e.map.read(n.x,n.y+1).index===0,c=e.map.read(n.x+1,n.y).index===0,h=e.map.read(n.x-1,n.y-1).index===0,u=e.map.read(n.x+1,n.y-1).index===0,m=e.map.read(n.x-1,n.y+1).index===0,l=e.map.read(n.x+1,n.y+1).index===0;o&&a?i.push({x:n.x,y:n.y,sprite:n.sprite+"_tl"}):o&&c?i.push({x:n.x,y:n.y,sprite:n.sprite+"_tr"}):o&&!a&&!c?i.push({x:n.x,y:n.y,sprite:n.sprite+"_t"}):h&&!a&&!o?i.push({x:n.x,y:n.y,sprite:n.sprite+"_i_tl"}):u&&!c&&!o?i.push({x:n.x,y:n.y,sprite:n.sprite+"_i_tr"}):a&&!o&&!s?i.push({x:n.x,y:n.y,sprite:n.sprite+"_l"}):s&&a?i.push({x:n.x,y:n.y,sprite:n.sprite+"_bl"}):s&&c?i.push({x:n.x,y:n.y,sprite:n.sprite+"_br"}):s&&!a&&!c?i.push({x:n.x,y:n.y,sprite:n.sprite+"_b"}):m&&!a&&!s?i.push({x:n.x,y:n.y,sprite:n.sprite+"_i_bl"}):l&&!c&&!s?i.push({x:n.x,y:n.y,sprite:n.sprite+"_i_br"}):c&&!o&&!s&&i.push({x:n.x,y:n.y,sprite:n.sprite+"_r"})}for(let n of i)B.spriteSheet.sprites.hasOwnProperty(n.sprite)&&Ie(e,n)}function Ie(e,{sprite:t,x:r,y:i}){let n=e.editor?.pendingChanges.get(`${r},${i}`);if(n||(n={type:"TILE_CHANGE",x:r,y:i,map:"overworld",value:{sprite:"",animated:!1,walkable:!1,triggerId:0,spatialHash:!1}},e.editor?.pendingChanges.set(`${r},${i}`,n)),n.type==="TILE_CHANGE"){Object.assign(n.value,{sprite:t,animated:!1,walkable:t!=="",triggerId:0,spatialHash:t!==""});let o=t===""?0:B.spriteSheet.sprites[t].index;e.map.write(r,i,{...n.value,index:o})}}function Wn(e,t,r){if(!!t.editor&&t.editor.active){let i=Me(y.create(),e.mouse.position,t.screen);t.solidEffect.use(n=>{n.draw(Ut(y.create(),i,{...t.screen,...e.screen}),y.fromValues(1,0,0,.5));let o=b.fromValues(t.character.animator.getSprite().width/2,t.character.animator.getSprite().height/2);n.draw(e.screen.toScreenSpace(y.create(),y.fromValues(Math.floor(t.character.relativePosition[1])-o[1]+t.character.boundingBox[0],Math.floor(t.character.relativePosition[0])-o[0]+t.character.boundingBox[1],Math.floor(t.character.relativePosition[1])-o[1]+t.character.boundingBox[2],Math.floor(t.character.relativePosition[0])-o[0]+t.character.boundingBox[3])),y.fromValues(0,0,1,.5))})}}function Yn(e,t){let r=48271,i=2147483647,n=i/r,o=i%r,a=r*(e%n)-o*Math.floor(e/n);return a>=0?e=a:e=a+i,a=r*(t%n)-o*Math.floor(t/n),a>=0?t=a:t=a+i,e^t}var Nt=be({fixedUpdate:1e3/60,saveKey:"pixelheart",save:Ft,start:Gt,update:kt,draw:Ot,screen:{incrementSize:16,preferredWidthIncrements:20,preferredHeightIncrements:13}});Nt&&document.getElementById("root")?.appendChild(Nt);})();
//# sourceMappingURL=index.js.map
