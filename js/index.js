(()=>{var Ie=Object.defineProperty;var Vt=e=>Ie(e,"__esModule",{value:!0});var ne=(e,t)=>{Vt(e);for(var r in t)Ie(e,r,{get:t[r],enumerable:!0})};var Le=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var y=(e,t,r)=>(Le(e,t,"read from private field"),r?r.call(e):t.get(e)),ae=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},be=(e,t,r,n)=>(Le(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r);var P=1e-6,D=typeof Float32Array!="undefined"?Float32Array:Array,k=Math.random;var On=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var p={};ne(p,{add:()=>fr,adjoint:()=>$t,clone:()=>Ht,copy:()=>Yt,create:()=>Nt,determinant:()=>Zt,equals:()=>dr,exactEquals:()=>mr,frob:()=>hr,fromMat2d:()=>nr,fromMat4:()=>zt,fromQuat:()=>ar,fromRotation:()=>rr,fromScaling:()=>ir,fromTranslation:()=>tr,fromValues:()=>Wt,identity:()=>Kt,invert:()=>jt,mul:()=>pr,multiply:()=>De,multiplyScalar:()=>lr,multiplyScalarAndAdd:()=>ur,normalFromMat4:()=>or,projection:()=>sr,rotate:()=>Qt,scale:()=>er,set:()=>qt,str:()=>cr,sub:()=>gr,subtract:()=>Ce,translate:()=>Jt,transpose:()=>Xt});function Nt(){var e=new D(9);return D!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function zt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function Ht(e){var t=new D(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Yt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Wt(e,t,r,n,i,a,o,s,c){var h=new D(9);return h[0]=e,h[1]=t,h[2]=r,h[3]=n,h[4]=i,h[5]=a,h[6]=o,h[7]=s,h[8]=c,h}function qt(e,t,r,n,i,a,o,s,c,h){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=s,e[7]=c,e[8]=h,e}function Kt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Xt(e,t){if(e===t){var r=t[1],n=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function jt(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],h=t[7],u=t[8],m=u*o-s*h,f=-u*a+s*c,g=h*a-o*c,v=r*m+n*f+i*g;return v?(v=1/v,e[0]=m*v,e[1]=(-u*n+i*h)*v,e[2]=(s*n-i*o)*v,e[3]=f*v,e[4]=(u*r-i*c)*v,e[5]=(-s*r+i*a)*v,e[6]=g*v,e[7]=(-h*r+n*c)*v,e[8]=(o*r-n*a)*v,e):null}function $t(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],h=t[7],u=t[8];return e[0]=o*u-s*h,e[1]=i*h-n*u,e[2]=n*s-i*o,e[3]=s*c-a*u,e[4]=r*u-i*c,e[5]=i*a-r*s,e[6]=a*h-o*c,e[7]=n*c-r*h,e[8]=r*o-n*a,e}function Zt(e){var t=e[0],r=e[1],n=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],h=e[8];return t*(h*a-o*c)+r*(-h*i+o*s)+n*(c*i-a*s)}function De(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],f=r[0],g=r[1],v=r[2],_=r[3],T=r[4],I=r[5],F=r[6],l=r[7],d=r[8];return e[0]=f*n+g*o+v*h,e[1]=f*i+g*s+v*u,e[2]=f*a+g*c+v*m,e[3]=_*n+T*o+I*h,e[4]=_*i+T*s+I*u,e[5]=_*a+T*c+I*m,e[6]=F*n+l*o+d*h,e[7]=F*i+l*s+d*u,e[8]=F*a+l*c+d*m,e}function Jt(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],f=r[0],g=r[1];return e[0]=n,e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=c,e[6]=f*n+g*o+h,e[7]=f*i+g*s+u,e[8]=f*a+g*c+m,e}function Qt(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],c=t[5],h=t[6],u=t[7],m=t[8],f=Math.sin(r),g=Math.cos(r);return e[0]=g*n+f*o,e[1]=g*i+f*s,e[2]=g*a+f*c,e[3]=g*o-f*n,e[4]=g*s-f*i,e[5]=g*c-f*a,e[6]=h,e[7]=u,e[8]=m,e}function er(e,t,r){var n=r[0],i=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function tr(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function rr(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ir(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function nr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function ar(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,c=i+i,h=r*o,u=n*o,m=n*s,f=i*o,g=i*s,v=i*c,_=a*o,T=a*s,I=a*c;return e[0]=1-m-v,e[3]=u-I,e[6]=f+T,e[1]=u+I,e[4]=1-h-v,e[7]=g-_,e[2]=f-T,e[5]=g+_,e[8]=1-h-m,e}function or(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=t[6],h=t[7],u=t[8],m=t[9],f=t[10],g=t[11],v=t[12],_=t[13],T=t[14],I=t[15],F=r*s-n*o,l=r*c-i*o,d=r*h-a*o,M=n*c-i*s,E=n*h-a*s,A=i*h-a*c,ge=u*_-m*v,ve=u*T-f*v,$=u*I-g*v,xe=m*T-f*_,Z=m*I-g*_,J=f*I-g*T,C=F*J-l*Z+d*xe+M*$-E*ve+A*ge;return C?(C=1/C,e[0]=(s*J-c*Z+h*xe)*C,e[1]=(c*$-o*J-h*ve)*C,e[2]=(o*Z-s*$+h*ge)*C,e[3]=(i*Z-n*J-a*xe)*C,e[4]=(r*J-i*$+a*ve)*C,e[5]=(n*$-r*Z-a*ge)*C,e[6]=(_*A-T*E+I*M)*C,e[7]=(T*d-v*A-I*l)*C,e[8]=(v*E-_*d+I*F)*C,e):null}function sr(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function cr(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function hr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function fr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function Ce(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function lr(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function ur(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function mr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function dr(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=e[6],h=e[7],u=e[8],m=t[0],f=t[1],g=t[2],v=t[3],_=t[4],T=t[5],I=t[6],F=t[7],l=t[8];return Math.abs(r-m)<=P*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(n-f)<=P*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(i-g)<=P*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-v)<=P*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-_)<=P*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-T)<=P*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(c-I)<=P*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(h-F)<=P*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(u-l)<=P*Math.max(1,Math.abs(u),Math.abs(l))}var pr=De,gr=Ce;var R={};ne(R,{add:()=>Sr,angle:()=>Hr,bezier:()=>Br,ceil:()=>Tr,clone:()=>vr,copy:()=>br,create:()=>Ue,cross:()=>Dr,dist:()=>Zr,distance:()=>Oe,div:()=>$r,divide:()=>Ge,dot:()=>ze,equals:()=>Kr,exactEquals:()=>qr,floor:()=>_r,forEach:()=>ti,fromValues:()=>xr,hermite:()=>Ur,inverse:()=>Ir,len:()=>Qr,length:()=>Be,lerp:()=>Cr,max:()=>wr,min:()=>Er,mul:()=>jr,multiply:()=>ke,negate:()=>Rr,normalize:()=>Lr,random:()=>Fr,rotateX:()=>Vr,rotateY:()=>Nr,rotateZ:()=>zr,round:()=>Mr,scale:()=>Ar,scaleAndAdd:()=>Pr,set:()=>yr,sqrDist:()=>Jr,sqrLen:()=>ei,squaredDistance:()=>Ve,squaredLength:()=>Ne,str:()=>Wr,sub:()=>Xr,subtract:()=>Fe,transformMat3:()=>Gr,transformMat4:()=>kr,transformQuat:()=>Or,zero:()=>Yr});function Ue(){var e=new D(3);return D!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function vr(e){var t=new D(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Be(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function xr(e,t,r){var n=new D(3);return n[0]=e,n[1]=t,n[2]=r,n}function br(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function yr(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function Sr(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function Fe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function ke(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ge(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Tr(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function _r(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Er(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function wr(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Mr(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Ar(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Pr(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Oe(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function Ve(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function Ne(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function Rr(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ir(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Lr(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function ze(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Dr(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],c=r[2];return e[0]=i*c-a*s,e[1]=a*o-n*c,e[2]=n*s-i*o,e}function Cr(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e}function Ur(e,t,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,c=o*(a-2)+a,h=o*(a-1),u=o*(3-2*a);return e[0]=t[0]*s+r[0]*c+n[0]*h+i[0]*u,e[1]=t[1]*s+r[1]*c+n[1]*h+i[1]*u,e[2]=t[2]*s+r[2]*c+n[2]*h+i[2]*u,e}function Br(e,t,r,n,i,a){var o=1-a,s=o*o,c=a*a,h=s*o,u=3*a*s,m=3*c*o,f=c*a;return e[0]=t[0]*h+r[0]*u+n[0]*m+i[0]*f,e[1]=t[1]*h+r[1]*u+n[1]*m+i[1]*f,e[2]=t[2]*h+r[2]*u+n[2]*m+i[2]*f,e}function Fr(e,t){t=t||1;var r=k()*2*Math.PI,n=k()*2-1,i=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=n*t,e}function kr(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}function Gr(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}function Or(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],c=t[1],h=t[2],u=i*h-a*c,m=a*s-n*h,f=n*c-i*s,g=i*f-a*m,v=a*u-n*f,_=n*m-i*u,T=o*2;return u*=T,m*=T,f*=T,g*=2,v*=2,_*=2,e[0]=s+u+g,e[1]=c+m+v,e[2]=h+f+_,e}function Vr(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Nr(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function zr(e,t,r,n){var i=[],a=[];return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e}function Hr(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],c=Math.sqrt(r*r+n*n+i*i),h=Math.sqrt(a*a+o*o+s*s),u=c*h,m=u&&ze(e,t)/u;return Math.acos(Math.min(Math.max(m,-1),1))}function Yr(e){return e[0]=0,e[1]=0,e[2]=0,e}function Wr(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function qr(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Kr(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=P*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=P*Math.max(1,Math.abs(i),Math.abs(s))}var Xr=Fe,jr=ke,$r=Ge,Zr=Oe,Jr=Ve,Qr=Be,ei=Ne,ti=function(){var e=Ue();return function(t,r,n,i,a,o){var s,c;for(r||(r=3),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,s=n;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();var w={};ne(w,{add:()=>oi,ceil:()=>si,clone:()=>ri,copy:()=>ni,create:()=>He,cross:()=>xi,dist:()=>Ii,distance:()=>Ke,div:()=>Ri,divide:()=>qe,dot:()=>vi,equals:()=>Mi,exactEquals:()=>wi,floor:()=>ci,forEach:()=>Ui,fromValues:()=>ii,inverse:()=>pi,len:()=>Di,length:()=>je,lerp:()=>bi,max:()=>fi,min:()=>hi,mul:()=>Pi,multiply:()=>We,negate:()=>di,normalize:()=>gi,random:()=>yi,round:()=>li,scale:()=>ui,scaleAndAdd:()=>mi,set:()=>ai,sqrDist:()=>Li,sqrLen:()=>Ci,squaredDistance:()=>Xe,squaredLength:()=>$e,str:()=>Ei,sub:()=>Ai,subtract:()=>Ye,transformMat4:()=>Si,transformQuat:()=>Ti,zero:()=>_i});function He(){var e=new D(4);return D!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ri(e){var t=new D(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ii(e,t,r,n){var i=new D(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function ni(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ai(e,t,r,n,i){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e}function oi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Ye(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function We(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function qe(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function si(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function ci(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function hi(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function fi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function li(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function ui(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function mi(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Ke(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.hypot(r,n,i,a)}function Xe(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function je(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.hypot(t,r,n,i)}function $e(e){var t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function di(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function pi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function gi(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function vi(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function xi(e,t,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],h=r[2]*n[3]-r[3]*n[2],u=t[0],m=t[1],f=t[2],g=t[3];return e[0]=m*h-f*c+g*s,e[1]=-(u*h)+f*o-g*a,e[2]=u*c-m*o+g*i,e[3]=-(u*s)+m*a-f*i,e}function bi(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e[3]=s+n*(r[3]-s),e}function yi(e,t){t=t||1;var r,n,i,a,o,s;do r=k()*2-1,n=k()*2-1,o=r*r+n*n;while(o>=1);do i=k()*2-1,a=k()*2-1,s=i*i+a*a;while(s>=1);var c=Math.sqrt((1-o)/s);return e[0]=t*r,e[1]=t*n,e[2]=t*i*c,e[3]=t*a*c,e}function Si(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}function Ti(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],c=r[2],h=r[3],u=h*n+s*a-c*i,m=h*i+c*n-o*a,f=h*a+o*i-s*n,g=-o*n-s*i-c*a;return e[0]=u*h+g*-o+m*-c-f*-s,e[1]=m*h+g*-s+f*-o-u*-c,e[2]=f*h+g*-c+u*-s-m*-o,e[3]=t[3],e}function _i(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ei(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function wi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Mi(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=t[0],s=t[1],c=t[2],h=t[3];return Math.abs(r-o)<=P*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=P*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-c)<=P*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-h)<=P*Math.max(1,Math.abs(a),Math.abs(h))}var Ai=Ye,Pi=We,Ri=qe,Ii=Ke,Li=Xe,Di=je,Ci=$e,Ui=function(){var e=He();return function(t,r,n,i,a,o){var s,c;for(r||(r=4),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,s=n;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();var x={};ne(x,{add:()=>Oi,angle:()=>on,ceil:()=>Vi,clone:()=>Bi,copy:()=>ki,create:()=>Ze,cross:()=>Zi,dist:()=>pn,distance:()=>tt,div:()=>dn,divide:()=>et,dot:()=>$i,equals:()=>fn,exactEquals:()=>hn,floor:()=>Ni,forEach:()=>xn,fromValues:()=>Fi,inverse:()=>Xi,len:()=>ln,length:()=>it,lerp:()=>Ji,max:()=>Hi,min:()=>zi,mul:()=>mn,multiply:()=>Qe,negate:()=>Ki,normalize:()=>ji,random:()=>Qi,rotate:()=>an,round:()=>Yi,scale:()=>Wi,scaleAndAdd:()=>qi,set:()=>Gi,sqrDist:()=>gn,sqrLen:()=>vn,squaredDistance:()=>rt,squaredLength:()=>nt,str:()=>cn,sub:()=>un,subtract:()=>Je,transformMat2:()=>en,transformMat2d:()=>tn,transformMat3:()=>rn,transformMat4:()=>nn,zero:()=>sn});function Ze(){var e=new D(2);return D!=Float32Array&&(e[0]=0,e[1]=0),e}function Bi(e){var t=new D(2);return t[0]=e[0],t[1]=e[1],t}function Fi(e,t){var r=new D(2);return r[0]=e,r[1]=t,r}function ki(e,t){return e[0]=t[0],e[1]=t[1],e}function Gi(e,t,r){return e[0]=t,e[1]=r,e}function Oi(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Je(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function Qe(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function et(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function Vi(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function Ni(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function zi(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Hi(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function Yi(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Wi(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function qi(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function tt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.hypot(r,n)}function rt(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function it(e){var t=e[0],r=e[1];return Math.hypot(t,r)}function nt(e){var t=e[0],r=e[1];return t*t+r*r}function Ki(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Xi(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ji(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function $i(e,t){return e[0]*t[0]+e[1]*t[1]}function Zi(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function Ji(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}function Qi(e,t){t=t||1;var r=k()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function en(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}function tn(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}function rn(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function nn(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}function an(e,t,r,n){var i=t[0]-r[0],a=t[1]-r[1],o=Math.sin(n),s=Math.cos(n);return e[0]=i*s-a*o+r[0],e[1]=i*o+a*s+r[1],e}function on(e,t){var r=e[0],n=e[1],i=t[0],a=t[1],o=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+a*a),s=o&&(r*i+n*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function sn(e){return e[0]=0,e[1]=0,e}function cn(e){return"vec2("+e[0]+", "+e[1]+")"}function hn(e,t){return e[0]===t[0]&&e[1]===t[1]}function fn(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=P*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=P*Math.max(1,Math.abs(n),Math.abs(a))}var ln=it,un=Je,mn=Qe,dn=et,pn=tt,gn=rt,vn=nt,xn=function(){var e=Ze();return function(t,r,n,i,a,o){var s,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,t.length):c=t.length,s=n;s<c;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();var b=16;function oe(e,t){return w.set(e,Math.floor(t[0]/b),Math.floor(t[1]/b),Math.floor(t[0])%b,Math.floor(t[1])%b)}var S=Symbol();function at(e,t){}async function Y(e,t,r){let n=await se(t),i={[S]:ce(e,n,r),width:n.width,height:n.height};return at(t,a=>{se(a).then(o=>{i[S]=ce(e,o,r),i.width=o.width,i.height=o.height})}),i}async function ot(e,t,r){let n=await se(t),i={image:n,[S]:ce(e,n,r),width:n.width,height:n.height};return at(t,a=>{se(a).then(o=>{i.image=o,i[S]=ce(e,o,r),i.width=o.width,i.height=o.height})}),i}function se(e){return new Promise((t,r)=>{let n=new Image;n.onload=()=>t(n),n.onerror=i=>r(i),n.src=e})}function ce(e,t,r){let n=e.gl.createTexture();return e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,n),e.gl.pixelStorei(e.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_S,r?.wrap||e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_WRAP_T,r?.wrap||e.gl.CLAMP_TO_EDGE),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MIN_FILTER,r?.wrap||e.gl.LINEAR),e.gl.texParameteri(e.gl.TEXTURE_2D,e.gl.TEXTURE_MAG_FILTER,r?.wrap||e.gl.LINEAR),e.gl.texImage2D(e.gl.TEXTURE_2D,0,e.gl.RGBA,e.gl.RGBA,e.gl.UNSIGNED_BYTE,t),e.gl.bindTexture(e.gl.TEXTURE_2D,null),n}var X=R.set(R.create(),0,1,0),j=R.set(R.create(),0,0,1),Q=R.cross(R.create(),X,j),bn=p.set(p.create(),X[0],Q[0],j[0],X[1],Q[1],j[1],X[2],Q[2],j[2]),he=p.transpose(p.create(),bn);function yn(e,t){}async function ee(e,t,r){let n=await r(e,t),i=st(t,n);return yn(t,a=>{Object.keys(i).forEach(o=>delete i[o]),Object.assign(i,st(a,n))}),i}function st(e,t){return Object.keys(e.sprites).reduce((r,n)=>{let i=e.sprites[n],a=i.frames.map(o=>w.fromValues(o.top,o.right,o.bottom,o.left));return r[n]={index:i.index,width:i.width,height:i.height,frames:a,draw:(o,s,c=0)=>(o.setTextures(t),o.draw(s,a[Math.floor(c)%a.length]),r[n])},r},{})}var fe=class{#e;#t;#n;constructor(t,r,n){this.frameRate=n,this.frame=0,this.#e=t,this.#n=r,this.#t=t[r]}tick(t){this.frame+=t*this.frameRate,this.frame>this.#t.frames.length&&(this.frame-=this.#t.frames.length)}getSprite(){return this.#t}getSpriteName(){return this.#n}setSprite(t){let r=this.#e[t];r!==this.#t&&(this.#t=r,this.#n=t,this.frame=0)}setSpriteOrTick(t,r){let n=this.#e[t];n!==this.#t?(this.#t=n,this.#n=t,this.frame=0):this.tick(r)}draw(t,r,n=0){this.#t.draw(t,r,this.frame+n)}};function ct(e,t){return{index:e[t],triggerId:e[t+1],walkable:(e[t+2]&1)==1,spatialHash:(e[t+2]&2)==2,animated:(e[t+2]&4)==4}}function ht(e,t,r){e[t]=r.index,e[t+1]=r.triggerId,e[t+2]=(r.walkable?1:0)|(r.spatialHash?2:0)|(r.animated?4:0)}async function ft(e,t,r,n){let[i,a]=await Promise.all([ee(e,r.spriteSheet,n),ot(e,r.url)]);return{data:new lt(e,t,a),sprite:i,spriteConfig:r.spriteSheet}}var lt=class{constructor(t,r,n){this.offscreen=t.createOffscreenCanvas(n.width,n.height,{willReadFrequently:!0}),this.offscreen.drawImage(n.image,0,0,n.width,n.height),this.width=n.width,this.height=n.height,this.tileSize=r,this.buffer=new ImageData(t.screen.width/r+3,t.screen.height/r+3),this.bufferPosition=w.create(),this.lastScreenPosition=x.create(),this.lastScreenWidth=0,this.lastScreenHeight=0}updateScreenBuffer(t,r){if(this.lastScreenWidth!==t.screen.width||this.lastScreenHeight!==t.screen.height||this.lastScreenPosition[0]!==r[0]||this.lastScreenPosition[1]!==r[1]){let n=oe(w.create(),r);this.bufferPosition=w.fromValues(n[0]-1,n[1]-1,t.screen.width/this.tileSize+3,t.screen.height/this.tileSize+3),this.buffer=this.offscreen.getImageData(this.bufferPosition[0],this.bufferPosition[1],this.bufferPosition[2],this.bufferPosition[3]),this.lastScreenPosition=x.clone(r),this.lastScreenWidth=t.screen.width,this.lastScreenHeight=t.screen.height}}read(t,r){if(t>=this.bufferPosition[0]&&t<this.bufferPosition[0]+this.bufferPosition[2]&&r>=this.bufferPosition[1]&&r<this.bufferPosition[1]+this.bufferPosition[3]){t-=this.bufferPosition[0],r-=this.bufferPosition[1];let n=4*(this.buffer.width*r+t);return ct(this.buffer.data,n)}else{let n=this.offscreen.getImageData(t,r,1,1);return ct(n.data,0)}}write(t,r,n){if(t>=this.bufferPosition[0]&&t<this.bufferPosition[0]+this.bufferPosition[2]&&r>=this.bufferPosition[1]&&r<this.bufferPosition[1]+this.bufferPosition[3]){t-=this.bufferPosition[0],r-=this.bufferPosition[1];let i=4*(this.buffer.width*r+t);ht(this.buffer.data,i,n),this.offscreen.putImageData(this.buffer,this.bufferPosition[0],this.bufferPosition[1])}else{let i=new ImageData(1,1);ht(i.data,0,n),this.offscreen.putImageData(i,t,r)}}};function ye(e,t,r){return r=Math.max(0,Math.min(1,(r-e)/(t-e))),r*r*(3-2*r)}function ut(e,t){let r=48271,n=2147483647,i=n/r,a=n%r,o=r*(e%i)-a*Math.floor(e/i);return o>=0?e=o:e=o+n,o=r*(t%i)-a*Math.floor(t/i),o>=0?t=o:t=o+n,e^t}var Se=class{#e;constructor(t){this.#e={},this.ready=!1;let r=Object.keys(t);Promise.all(r.map(n=>t[n])).then(n=>{r.reduce((i,a,o)=>(i[a]=n[o],i),this.#e),this.ready=!0})}ifReady(t){return this.ready&&t(this.#e),this.ready}};var W=p.create();p.scale(W,W,[1,-1]);p.translate(W,W,[-1,-1]);p.scale(W,W,[2,2]);var V=W,B=class{#e;#t;#n;#i;#r;constructor(t){this.#t=t,this.#r="",this.#i=null,this.#n=this.#t.createVertexArray();let r=new Float32Array([0,0,1,0,0,1,1,1]);this.#e=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.#e),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null)}#a(t,r){let n={position:t.inAttributes[r.position].location};return{...n,hash:`${n.position}`}}bind(t,r,n){let i=this.#a(t,r);this.#t.bindVertexArray(this.#n),(this.#r!==i.hash||this.#i!==null)&&(this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.enableVertexAttribArray(i.position),this.#t.vertexAttribPointer(i.position,2,this.#t.FLOAT,!1,0,0),this.#r=i.hash,this.#i=null),n({draw:()=>{this.#t.drawArrays(this.#t.TRIANGLE_STRIP,0,4)}}),this.#t.bindVertexArray(null)}bindInstances(t,r,n,i){let a=this.#a(t,r),o=n.getAttributesHash(t),s=`${a.hash}:${o}`;this.#t.bindVertexArray(this.#n),(this.#r!==s||this.#i!==n)&&(this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.enableVertexAttribArray(a.position),this.#t.vertexAttribPointer(a.position,2,this.#t.FLOAT,!1,0,0),this.#r=s,this.#i=n.bind(t));let c=n.getInstanceCount();i({draw:()=>{this.#t.drawArraysInstanced(this.#t.TRIANGLE_STRIP,0,4,c)}}),this.#t.bindVertexArray(null)}};var mt=null;function Sn(e,t,r){}var U=class{#e;#t;#n;#i;constructor(t,r,n){this.#e=t.gl,this.#n=r,this.#i=n,this.inAttributes={},this.outAttributes={},this.uniforms={},this.#t=this.#r(this.#n,this.#i),this.setAttributesAndUniforms(this.#n,this.#i),Sn(r,n,()=>{console.log("reloading...");try{this.#t=this.#r(this.#n,this.#i)}catch(i){console.error(i);return}this.setAttributesAndUniforms(this.#n,this.#i)})}setAttributesAndUniforms(t,r){let n=this.#e.getProgramParameter(this.#t,this.#e.ACTIVE_ATTRIBUTES);for(let a=0;a<n;++a){let o=this.#e.getActiveAttrib(this.#t,a);if(o){let s=o.name;s in t.inAttributes&&(this.inAttributes[s]={location:this.#e.getAttribLocation(this.#t,o.name),type:t.inAttributes[s].type})}}Object.keys(r.outAttributes).forEach(a=>{let o=this.#e.getFragDataLocation(this.#t,a);this.outAttributes[a]={location:o,type:r.outAttributes[a].type}});let i=this.#e.getProgramParameter(this.#t,this.#e.ACTIVE_UNIFORMS);for(let a=0;a<i;++a){let o=this.#e.getActiveUniform(this.#t,a);if(o){let s=o.name;(s in t.uniforms||s in r.uniforms)&&(this.uniforms[o.name]={location:this.#e.getUniformLocation(this.#t,o.name),type:t.uniforms[s]||r.uniforms[s]})}}}#r(t,r){let n=this.#e.createProgram(),i=this.#e.createShader(this.#e.VERTEX_SHADER),a=mt?.get(t.name)||t.src;this.#e.shaderSource(i,a),this.#e.compileShader(i);let o="";if(!this.#e.getShaderParameter(i,this.#e.COMPILE_STATUS)){let h=this.#e.getShaderInfoLog(i);h&&(o+=h+`
`)}let s=this.#e.createShader(this.#e.FRAGMENT_SHADER),c=mt?.get(r.name)||r.src;if(this.#e.shaderSource(s,c),this.#e.compileShader(s),!this.#e.getShaderParameter(s,this.#e.COMPILE_STATUS)){let h=this.#e.getShaderInfoLog(s);h&&(o+=h+`
`)}if(this.#e.attachShader(n,i),this.#e.attachShader(n,s),o===""&&(this.#e.linkProgram(n),!this.#e.getProgramParameter(n,this.#e.LINK_STATUS))){let h=this.#e.getProgramInfoLog(n);h&&(o+=`
Linker: (${t.name}, ${r.name}): ${h}`)}if(o!=="")throw new Error(`Shader compilation of [${t.name}, ${r.name}] failed:
${o}`);return n}use(t){this.#e.useProgram(this.#t),t(this),this.#e.useProgram(null)}setUniforms(t){let r=0;for(let n in t){let i=t[n],a=this.uniforms[n];if(a)a.type==="sampler2D"?(this.#e.activeTexture(this.#e[`TEXTURE${r}`]),this.#e.bindTexture(this.#e.TEXTURE_2D,i),this.#e.uniform1i(a.location,r++)):a.type==="float"?this.#e.uniform1f(a.location,i):a.type==="vec2"?this.#e.uniform2fv(a.location,i):a.type==="vec3"?this.#e.uniform3fv(a.location,i):a.type==="vec4"?this.#e.uniform4fv(a.location,i):a.type==="mat2"?this.#e.uniformMatrix2fv(a.location,!1,i):a.type==="mat3"?this.#e.uniformMatrix3fv(a.location,!1,i):a.type==="mat4"?this.#e.uniformMatrix4fv(a.location,!1,i):a.type==="int"&&this.#e.uniform1i(a.location,i);else continue}return this}},N=class{#e;#t;#n;#i;#r=[];constructor(t,r,n){this.#t=t,this.#e=this.#t.createBuffer(),this.#i=0,this.#n=0,this.#r=[];for(let[i,a]of Object.entries(n)){let o=r.inAttributes[i].type;if(o==="float")this.#r.push({col:1,row:1,size:1,name:i,load:(s,c,h)=>{s[c]=a(h)}});else{let s={name:i,load:(c,h,u)=>c.set(a(u),h)};switch(o){case"vec2":this.#r.push({col:1,row:2,size:2,...s});break;case"vec3":this.#r.push({col:1,row:3,size:3,...s});break;case"vec4":this.#r.push({col:1,row:4,size:4,...s});break;case"mat2":this.#r.push({col:2,row:2,size:4,...s});break;case"mat3":this.#r.push({col:3,row:3,size:9,...s});break;case"mat4":this.#r.push({col:4,row:4,size:16,...s});break;default:throw new Error("Unknown instance buffer attribute type")}}this.#n+=this.#r[this.#r.length-1].size}}load(t){this.#i=t.length;let r=new Float32Array(t.length*this.#n),n=0;for(let i=0;i<t.length;++i)for(let a=0;a<this.#r.length;++a)this.#r[a].load(r,n,t[i]),n+=this.#r[a].size;return this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e),this.#t.bufferData(this.#t.ARRAY_BUFFER,r,this.#t.STREAM_DRAW),this.#t.bindBuffer(this.#t.ARRAY_BUFFER,null),this}getInstanceCount(){return this.#i}getAttributesHash(t){return this.#r.map(r=>t.inAttributes[r.name].location).join("-")}bind(t){this.#t.bindBuffer(this.#t.ARRAY_BUFFER,this.#e);let r=0;for(let n=0;n<this.#r.length;++n){let i=t.inAttributes[this.#r[n].name].location;for(let a=0;a<this.#r[n].col;++a)this.#t.enableVertexAttribArray(i+a),this.#t.vertexAttribPointer(i+a,this.#r[n].row,this.#t.FLOAT,!1,this.#n*4,r),this.#t.vertexAttribDivisor(i+a,1),r+=this.#r[n].row*4}return this}},L,q,H,K=class{constructor(t,r,n){ae(this,L,void 0);ae(this,q,void 0);be(this,L,t),be(this,q,y(this,L).createFramebuffer()),y(this,L).bindFramebuffer(y(this,L).FRAMEBUFFER,y(this,q));let i=[];Object.entries(n).forEach(([a,o])=>{let s=r.outAttributes[a].location;y(this,L).framebufferTexture2D(y(this,L).FRAMEBUFFER,y(this,L)[`COLOR_ATTACHMENT${s}`],y(this,L).TEXTURE_2D,o,0),i.push(y(this,L)[`COLOR_ATTACHMENT${s}`])}),y(this,L).drawBuffers(i.sort((a,o)=>a-o)),y(this,L).bindFramebuffer(y(this,L).FRAMEBUFFER,null)}bind(t){y(K,H).push(y(this,q)),y(this,L).bindFramebuffer(y(this,L).FRAMEBUFFER,y(this,q)),t(),y(K,H).pop(),y(K,H).length?y(this,L).bindFramebuffer(y(this,L).FRAMEBUFFER,y(K,H)[y(K,H).length-1]):y(this,L).bindFramebuffer(y(this,L).FRAMEBUFFER,null)}},O=K;L=new WeakMap,q=new WeakMap,H=new WeakMap,ae(O,H,[]);function z(e,t,r,n,i,a,o){let s=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o?.wrap||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o?.wrap||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,o?.filter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o?.filter||e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,t,i,a,0,r,n,null),e.bindTexture(e.TEXTURE_2D,null),s}var te;(function(r){r[r.LIGHTING_MODE_DIRECTIONAL=0]="LIGHTING_MODE_DIRECTIONAL",r[r.LIGHTING_MODE_POINT=1]="LIGHTING_MODE_POINT"})(te||(te={}));var Tn={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;in vec3 v_ambient;in vec3 v_diffuse;in vec3 v_direction;in float v_radius;uniform vec3 u_viewDirection;uniform int u_lightingMode;uniform sampler2D u_albedoTexture;uniform sampler2D u_normalTexture;uniform sampler2D u_specularTexture;uniform mat3 u_toTangentSpace;const int A=0;const int B=1;const float C=2.;const float D=32.;layout(location=0)out vec4 o_lighting;void main(){vec3 E=normalize(texture(u_normalTexture,v_texCoord).rgb*2.-1.);vec3 F=texture(u_albedoTexture,v_texCoord).rgb;vec3 G=texture(u_specularTexture,v_texCoord).rgb;vec3 H=v_ambient*F;vec3 I=u_lightingMode==A?v_direction:vec3(v_texCoord,0.)-v_direction;I.y*=u_lightingMode==A?1.:-1.;float J=u_lightingMode==A?1.:pow(1.-min(v_radius,length(I))/v_radius,C);vec3 K=normalize(I*-1.)*u_toTangentSpace;float L=max(dot(E,K),0.);vec3 M=F*v_diffuse*L*J;vec3 N=normalize(K+(u_viewDirection*-1.*u_toTangentSpace));float O=max(dot(E,N),0.);float P=pow(O,D);vec3 Q=v_diffuse*P*G*J;o_lighting=vec4(H+M+Q,1.);}`,name:"deferred-lighting.frag",inAttributes:{},outAttributes:{o_lighting:{type:"vec4",location:0}},uniforms:{u_viewDirection:"vec3",u_lightingMode:"int",u_albedoTexture:"sampler2D",u_normalTexture:"sampler2D",u_specularTexture:"sampler2D",u_toTangentSpace:"mat3"}},dt=Tn;var pt;(function(e){})(pt||(pt={}));var _n={src:`#version 300 es
in vec2 a_position;in mat3 a_mvp;in mat3 a_uv;in vec3 a_ambient;in vec3 a_diffuse;in vec3 a_direction;in float a_radius;out vec3 v_ambient;out vec3 v_diffuse;out vec3 v_direction;out float v_radius;out vec2 v_texCoord;void main(){vec3 A=a_uv*vec3(a_position,1.);v_texCoord=A.xy;v_ambient=a_ambient;v_diffuse=a_diffuse;v_direction=a_direction;v_radius=a_radius;vec3 B=a_mvp*vec3(a_position,1.);gl_Position=vec4(B.xy,0.,1.);}`,name:"deferred-lighting.vert",inAttributes:{a_position:{type:"vec2"},a_mvp:{type:"mat3"},a_uv:{type:"mat3"},a_ambient:{type:"vec3"},a_diffuse:{type:"vec3"},a_direction:{type:"vec3"},a_radius:{type:"float"}},outAttributes:{},uniforms:{}},gt=_n;var vt;(function(e){})(vt||(vt={}));var En={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;uniform sampler2D u_diffuseTexture;uniform sampler2D u_normalTexture;uniform sampler2D u_specularTexture;uniform sampler2D u_emissiveTexture;layout(location=0)out vec4 o_normal;layout(location=1)out vec4 o_albedo;layout(location=2)out vec4 o_specular;layout(location=3)out vec4 o_lighting;layout(location=4)out vec4 o_mask;void main(){vec4 A=texture(u_diffuseTexture,v_texCoord);vec3 B=texture(u_normalTexture,v_texCoord).xyz;float C=texture(u_specularTexture,v_texCoord).x;vec3 D=texture(u_emissiveTexture,v_texCoord).xyz;float E=A.w<0.99?0.:1.;o_albedo=vec4(A.xyz*E,E);o_mask=o_albedo;o_normal=vec4(B,E);o_specular=vec4(C,C,C,E);o_lighting=vec4(D,E);}`,name:"deferred-sprite.frag",inAttributes:{},outAttributes:{o_normal:{type:"vec4",location:0},o_albedo:{type:"vec4",location:1},o_specular:{type:"vec4",location:2},o_lighting:{type:"vec4",location:3},o_mask:{type:"vec4",location:4}},uniforms:{u_diffuseTexture:"sampler2D",u_normalTexture:"sampler2D",u_specularTexture:"sampler2D",u_emissiveTexture:"sampler2D"}},xt=En;var bt;(function(e){})(bt||(bt={}));var wn={src:`#version 300 es
in vec2 a_position;in mat3 a_uv;in mat3 a_mvp;out vec2 v_texCoord;void main(){vec3 A=a_uv*vec3(a_position,1.);vec3 B=a_mvp*vec3(a_position,1.);v_texCoord=A.xy;gl_Position=vec4(B.xy,0.,1.);}`,name:"deferred-sprite.vert",inAttributes:{a_position:{type:"vec2"},a_uv:{type:"mat3"},a_mvp:{type:"mat3"}},outAttributes:{},uniforms:{}},yt=wn;var Te=class extends fe{},Mn=R.fromValues(0,0,0),re=p.create();p.scale(re,re,[1,-1]);p.mul(re,re,V);var ie=p.create();p.translate(ie,ie,[0,0]);p.scale(ie,ie,[1,1]);async function _e(e,t){let[r,n,i,a]=await Promise.all([Y(e,t.urls.diffuse),Y(e,t.urls.normal),Y(e,t.urls.specular),Y(e,t.urls.emissive)]);return{diffuseTexture:r,normalTexture:n,specularTexture:i,emissiveTexture:a}}var Ee=class{#e;#t;#n;#i;#r;#a;#o;#c;#s;#f;#h;#l;#u;constructor(t){this.#e=t.gl,this.#t=new U(t,yt,xt),this.#n=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_uv:r=>r.uv}),this.#i=[],this.#r=new U(t,gt,dt),this.#a=new N(this.#e,this.#r,{a_mvp:r=>r.mvp,a_uv:r=>r.uv,a_ambient:r=>r.ambient,a_diffuse:r=>r.diffuse,a_direction:r=>r.direction,a_radius:r=>r.radius}),this.#o=[],this.#c=[],this.#f=new B(this.#e),this.#s=null,this.#h=null,this.#l=this.#u=0}use(t,r,n){if(!this.#h||t.width!==this.#l||t.height!==this.#u){this.#u=t.height,this.#l=t.width;let a={normal:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),albedo:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),specular:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),lighting:{[S]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height},mask:{[S]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height}};this.#h={...a,maskFrameBuffer:new O(this.#e,this.#t,{o_normal:a.normal,o_albedo:a.albedo,o_specular:a.specular,o_lighting:a.lighting[S],o_mask:a.mask[S]}),noMaskFrameBuffer:new O(this.#e,this.#t,{o_normal:a.normal,o_albedo:a.albedo,o_specular:a.specular,o_lighting:a.lighting[S],o_mask:null}),lightingFrameBuffer:new O(this.#e,this.#r,{o_lighting:a.lighting[S]})}}let i=this.#h;i.maskFrameBuffer.bind(()=>{this.#e.viewport(0,0,this.#l,this.#u),this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#t.use(()=>{r(this,0),this.#m()})}),i.noMaskFrameBuffer.bind(()=>{n(i.mask),this.#t.use(()=>{r(this,1),this.#m()})}),i.lightingFrameBuffer.bind(()=>{let a=this.#e.getParameter(this.#e.BLEND),o=this.#e.getParameter(this.#e.BLEND_SRC_ALPHA),s=this.#e.getParameter(this.#e.BLEND_DST_ALPHA);this.#e.enable(this.#e.BLEND),this.#e.blendFunc(this.#e.ONE,this.#e.ONE),this.#r.use(c=>{c.setUniforms({u_albedoTexture:i.albedo,u_normalTexture:i.normal,u_specularTexture:i.specular,u_toTangentSpace:he,u_viewDirection:R.fromValues(0,0,-1)}),this.#o.length&&(c.setUniforms({u_lightingMode:te.LIGHTING_MODE_DIRECTIONAL}),this.#f.bindInstances(c,{position:"a_position"},this.#a.load(this.#o),h=>h.draw()),this.#o.length=0),this.#c.length&&(c.setUniforms({u_lightingMode:te.LIGHTING_MODE_POINT}),this.#f.bindInstances(c,{position:"a_position"},this.#a.load(this.#c),h=>h.draw()),this.#c.length=0)}),a||this.#e.disable(this.#e.BLEND),this.#e.blendFunc(o,s)})}addDirectionalLight(t){return this.#o.push({mvp:re,uv:ie,ambient:t.ambient,diffuse:t.diffuse,direction:t.direction,radius:0}),this}addPointLight(t){if(t.position[2]>=t.radius)return this;let r=Math.sqrt(t.radius*t.radius-t.position[2]*t.position[2]),n=p.create();p.translate(n,n,[t.position[0]-r,t.position[1]-r]),p.scale(n,n,[r*2,r*2]),p.mul(n,V,n);let i=p.create();return p.translate(i,i,[t.position[0]-r,1-t.position[1]+r]),p.scale(i,i,[r*2,r*2]),p.scale(i,i,[1,-1]),this.#c.push({mvp:n,uv:i,ambient:Mn,diffuse:t.diffuse,direction:R.fromValues(t.position[0],1-t.position[1],t.position[2]),radius:t.radius}),this}getLightingTexture(){return this.#h?.lighting}setTextures(t){return t===this.#s?this:(this.#i.length&&this.#m(),this.#s=t,this.#t.setUniforms({u_diffuseTexture:t.diffuseTexture[S],u_normalTexture:t.normalTexture[S],u_specularTexture:t.specularTexture[S],u_emissiveTexture:t.emissiveTexture[S]}),this)}draw(t,r){if(this.#s){let n=p.create();p.translate(n,n,[t[3],t[0]]),p.scale(n,n,[t[1]-t[3],t[2]-t[0]]),p.multiply(n,V,n);let i=p.create();p.translate(i,i,[r[3]/this.#s.diffuseTexture.width,r[0]/this.#s.diffuseTexture.height]),p.scale(i,i,[(r[1]-r[3])/this.#s.diffuseTexture.width,(r[2]-r[0])/this.#s.diffuseTexture.height]),this.#i.push({mvp:n,uv:i})}return this}#m(){!this.#i.length||(this.#f.bindInstances(this.#t,{position:"a_position"},this.#n.load(this.#i),t=>t.draw()),this.#i.length=0,this.#s=null)}};var An={name:"overworld",sprites:{grass_b:{index:1,width:16,height:16,frames:[{top:0,left:0,bottom:16,right:16}]},grass_bl:{index:2,width:16,height:16,frames:[{top:16,left:0,bottom:32,right:16}]},grass_br:{index:3,width:16,height:16,frames:[{top:32,left:0,bottom:48,right:16}]},grass_i_bl:{index:4,width:16,height:16,frames:[{top:48,left:0,bottom:64,right:16}]},grass_i_br:{index:5,width:16,height:16,frames:[{top:64,left:0,bottom:80,right:16}]},grass_t:{index:6,width:16,height:16,frames:[{top:80,left:0,bottom:96,right:16}]},grass_tl:{index:7,width:16,height:16,frames:[{top:96,left:0,bottom:112,right:16}]},grass_tr:{index:8,width:16,height:16,frames:[{top:112,left:0,bottom:128,right:16}]},grass_i_tl:{index:9,width:16,height:16,frames:[{top:128,left:0,bottom:144,right:16}]},grass_i_tr:{index:10,width:16,height:16,frames:[{top:144,left:0,bottom:160,right:16}]},grass_l:{index:11,width:16,height:16,frames:[{top:160,left:0,bottom:176,right:16}]},grass_r:{index:12,width:16,height:16,frames:[{top:176,left:0,bottom:192,right:16}]},grass:{index:13,width:16,height:16,frames:[{top:192,left:0,bottom:208,right:16},{top:192,left:16,bottom:208,right:32},{top:192,left:32,bottom:208,right:48},{top:192,left:48,bottom:208,right:64}]},water:{index:14,width:16,height:16,frames:[{top:208,left:0,bottom:224,right:16},{top:208,left:16,bottom:224,right:32},{top:208,left:32,bottom:224,right:48},{top:208,left:48,bottom:224,right:64},{top:208,left:64,bottom:224,right:80},{top:208,left:80,bottom:224,right:96},{top:208,left:96,bottom:224,right:112},{top:208,left:112,bottom:224,right:128}]}},indexes:["","grass_b","grass_bl","grass_br","grass_i_bl","grass_i_br","grass_t","grass_tl","grass_tr","grass_i_tl","grass_i_tr","grass_l","grass_r","grass","water"],urls:{diffuse:"/sprites/overworld-diffuse.png?v=ea02439ea304fa9e0d848d7912c7d7d15b925fc407375d8640c4f34f53488b59",emissive:"/sprites/overworld-emissive.png?v=7e964b09ced6bc0c687bf7ecdb19a52cb3292c73da1ab2b7ef5d5a58b36ddfaa",normal:"/sprites/overworld-normal.png?v=0505155085fd370a373a67399716ed59767af6c1bc2e2d510569b68d836b286a",specular:"/sprites/overworld-specular.png?v=55f7d8c380b7ae96744f2a603c471cac28960f274676126a554b1600db787175"}},St=An;var Pn={width:100,height:100,startPosition:{x:10,y:10},spriteSheet:"overworld",url:"/maps/overworld.png?v=f2e3bb1d3a08855d97386b3b1f3f75ae7f21e92d6a6b7bead113984172e722df",spriteSheet:St},le=Pn;var Rn={name:"character",sprites:{walk_d:{index:1,width:16,height:32,frames:[{top:0,left:0,bottom:32,right:16},{top:0,left:16,bottom:32,right:32},{top:0,left:32,bottom:32,right:48},{top:0,left:48,bottom:32,right:64}]},walk_u:{index:2,width:16,height:32,frames:[{top:32,left:0,bottom:64,right:16},{top:32,left:16,bottom:64,right:32},{top:32,left:32,bottom:64,right:48},{top:32,left:48,bottom:64,right:64}]},walk_l:{index:3,width:16,height:32,frames:[{top:64,left:0,bottom:96,right:16},{top:64,left:16,bottom:96,right:32},{top:64,left:32,bottom:96,right:48},{top:64,left:48,bottom:96,right:64}]},walk_r:{index:4,width:16,height:32,frames:[{top:96,left:0,bottom:128,right:16},{top:96,left:16,bottom:128,right:32},{top:96,left:32,bottom:128,right:48},{top:96,left:48,bottom:128,right:64}]}},indexes:["","walk_d","walk_u","walk_l","walk_r"],urls:{diffuse:"/sprites/character-diffuse.png?v=9f00a75a66e129cec549aa5a71a0299b95836a14d7e9cb3829128e3af40c5ced",emissive:"/sprites/character-emissive.png?v=269513c7efa74adea87bfedc176d2edce2df1c754a8fbcc31665f1a9a0238bf0",normal:"/sprites/character-normal.png?v=4d73d74cb4bd80a94e31caf56877ea254b3f4c08ecd24b593df0cd693bced45e",specular:"/sprites/character-specular.png?v=a96da987d48f9677939e8a0127a29912b247d8bded2cc42d28b867e3bff8f398"}},Tt=Rn;var In={name:"ui",sprites:{touch:{index:1,width:64,height:64,frames:[{top:0,left:0,bottom:64,right:64}]}},indexes:["","touch"],urls:{diffuse:"/sprites/ui-diffuse.png?v=4edaa65c0c8da93ba283fb9dfa8fc44c6cd7a4238aa81e48175c702eac0a703e",emissive:"/sprites/ui-emissive.png?v=ebb17149ce1cf937cadfb8e903b2812b9a0ecc366eb7705e40e3c73461dc082f",normal:"/sprites/ui-normal.png?v=fab0d72f495130a5aab540c29aee75180b94f27cdbf5c5a0b806feb39a148b59",specular:"/sprites/ui-specular.png?v=01c6ec306f27fa4865bd1f3105fca42b0b9da17a429013e82bf32f1bf88a1944"}},_t=In;var Et;(function(t){t[t.offset=16]="offset"})(Et||(Et={}));var Ln={src:`#version 300 es
precision mediump float;uniform sampler2D u_blur;uniform vec2 u_blurSize;uniform vec2 u_blurDirection;uniform float u_blurStrength;in vec2 v_texCoord;out vec4 o_color;const int A=16;void main(){float B=texture(u_blur,v_texCoord).a;vec3 C=vec3(0.);for(int D=0;D<A;++D){vec2 E=v_texCoord+((vec2(-D,-D)*u_blurDirection)/u_blurSize);vec4 F=texture(u_blur,E);float G=F.a*pow(float(A-D)/float(A),u_blurStrength);B=max(B,G);C=length(C)<length(F.rgb)?F.rgb:C;vec2 H=v_texCoord+((vec2(D,D)*u_blurDirection)/u_blurSize);vec4 I=texture(u_blur,H);float J=I.a*pow(float(A-D)/float(A),u_blurStrength);B=max(B,J);C=length(C)<length(I.rgb)?I.rgb:C;}o_color=vec4(C,B);}`,name:"nearest-blur.frag",inAttributes:{},outAttributes:{o_color:{type:"vec4"}},uniforms:{u_blur:"sampler2D",u_blurSize:"vec2",u_blurDirection:"vec2",u_blurStrength:"float"}},wt=Ln;var Mt;(function(e){})(Mt||(Mt={}));var Dn={src:`#version 300 es
in vec2 a_position;out vec2 v_texCoord;void main(){v_texCoord=a_position;gl_Position=vec4(a_position*2.-1.,0.,1.);}`,name:"quad.vert",inAttributes:{a_position:{type:"vec2"}},outAttributes:{},uniforms:{}},ue=Dn;var we=class{#e;#t;#n;#i;constructor(t){this.#e=t.gl,this.#t=new U(t,ue,wt),this.#n=new B(this.#e),this.#i=null}draw(t,r){if(!this.#i||this.#i.textures[0].width!==t.width||this.#i.textures[0].height!==t.height){let a=[];for(let o=0;o<2;o++)a.push({[S]:z(this.#e,this.#e.RGBA,this.#e.RGBA,this.#e.UNSIGNED_BYTE,t.width,t.height),width:t.width,height:t.height});this.#i={textures:a,frameBuffers:[new O(this.#e,this.#t,{o_color:a[0][S]}),new O(this.#e,this.#t,{o_color:a[1][S]})]}}let n=this.#e.getParameter(this.#e.BLEND);this.#e.disable(this.#e.BLEND);let i=this.#i;return this.#t.use(a=>{this.#e.viewport(0,0,t.width,t.height),a.setUniforms({u_blur:t[S],u_blurSize:[t.width,t.height],u_blurDirection:[0,1],u_blurStrength:r}),i.frameBuffers[0].bind(()=>{this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#n.bind(this.#t,{position:"a_position"},o=>{o.draw()})}),a.setUniforms({u_blur:i.textures[0][S],u_blurSize:[i.textures[0].width,i.textures[0].height],u_blurDirection:[1,0]}),i.frameBuffers[1].bind(()=>{this.#e.clear(this.#e.COLOR_BUFFER_BIT|this.#e.DEPTH_BUFFER_BIT),this.#n.bind(this.#t,{position:"a_position"},o=>{o.draw()})}),this.#e.viewport(0,0,t.width,t.height)}),n&&this.#e.enable(this.#e.BLEND),this}getBlurTexture(){return this.#i.textures[1]}};var At;(function(e){})(At||(At={}));var Cn={src:`#version 300 es
precision mediump float;in vec4 v_color;out vec4 outColor;void main(){outColor=v_color;}`,name:"solid.frag",inAttributes:{},outAttributes:{outColor:{type:"vec4"}},uniforms:{}},Pt=Cn;var Rt;(function(e){})(Rt||(Rt={}));var Un={src:`#version 300 es
in vec2 a_position;in vec4 a_color;in mat3 a_mvp;out vec4 v_color;void main(){v_color=a_color;vec3 A=a_mvp*vec3(a_position,1.);gl_Position=vec4(A.xy,0.,1.);}`,name:"solid.vert",inAttributes:{a_position:{type:"vec2"},a_color:{type:"vec4"},a_mvp:{type:"mat3"}},outAttributes:{},uniforms:{}},It=Un;var Me=class{#e;#t;#n;#i;#r;constructor(t){this.#e=t.gl,this.#t=new U(t,It,Pt),this.#n=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_color:r=>r.color}),this.#i=new B(this.#e),this.#r=[]}use(t){this.#t.use(()=>{t(this),this.#a()})}draw(t,r){let n=p.create();return p.translate(n,n,[t[3],t[0]]),p.scale(n,n,[t[1]-t[3],t[2]-t[0]]),p.multiply(n,V,n),this.#r.push({mvp:n,color:r}),this}#a(){this.#i.bindInstances(this.#t,{position:"a_position"},this.#n.load(this.#r),t=>t.draw()),this.#r=[]}};var Lt;(function(e){})(Lt||(Lt={}));var Bn={src:`#version 300 es
precision mediump float;in vec2 v_texCoord;in float v_alpha;uniform sampler2D u_texture;out vec4 outColor;void main(){outColor=texture(u_texture,v_texCoord);outColor.a*=v_alpha;}`,name:"sprite.frag",inAttributes:{},outAttributes:{outColor:{type:"vec4"}},uniforms:{u_texture:"sampler2D"}},Dt=Bn;var Ct;(function(e){})(Ct||(Ct={}));var Fn={src:`#version 300 es
in vec2 a_position;in mat3 a_uv;in mat3 a_mvp;in float a_alpha;out vec2 v_texCoord;out float v_alpha;void main(){vec3 A=a_uv*vec3(a_position,1.);vec3 B=a_mvp*vec3(a_position,1.);v_alpha=a_alpha;v_texCoord=A.xy;gl_Position=vec4(B.xy,0.,1.);}`,name:"sprite.vert",inAttributes:{a_position:{type:"vec2"},a_uv:{type:"mat3"},a_mvp:{type:"mat3"},a_alpha:{type:"float"}},outAttributes:{},uniforms:{}},Ut=Fn;async function Bt(e,t){return await Y(e,t.urls.diffuse)}var Ae=class{#e;#t;#n;#i;#r;#a;#o;constructor(t){this.#e=t.gl,this.#t=new U(t,Ut,Dt),this.#n=new N(this.#e,this.#t,{a_mvp:r=>r.mvp,a_uv:r=>r.uv,a_alpha:r=>r.alpha}),this.#i=new B(this.#e),this.#a=[],this.#r=null,this.#o=1}use(t){this.#t.use(()=>{this.#o=1,t(this),this.#c()})}setTextures(t){return t===this.#r?this:(this.#a.length&&this.#c(),this.#r=t,this.#t.setUniforms({u_texture:t[S]}),this)}setAlpha(t){return this.#o=t,this}draw(t,r){if(this.#r){let n=p.create();p.translate(n,n,[t[3],t[0]]),p.scale(n,n,[t[1]-t[3],t[2]-t[0]]),p.multiply(n,V,n);let i=p.create();p.translate(i,i,[r[3]/this.#r.width,r[0]/this.#r.height]),p.scale(i,i,[(r[1]-r[3])/this.#r.width,(r[2]-r[0])/this.#r.height]),this.#a.push({mvp:n,uv:i,alpha:this.#o})}return this}#c(){this.#i.bindInstances(this.#t,{position:"a_position"},this.#n.load(this.#a),t=>{t.draw()}),this.#a=[],this.#r=null}};var Ft;(function(t){t[t.nwaves=12]="nwaves"})(Ft||(Ft={}));var kn={src:`#version 300 es
precision mediump float;layout(location=0)out vec4 o_normal;layout(location=1)out vec4 o_albedo;layout(location=2)out vec4 o_specular;layout(location=3)out vec4 o_lighting;layout(location=4)out vec4 o_mask;in vec2 v_texCoord;uniform sampler2D u_mask;uniform sampler2D u_depth;uniform float u_time;uniform vec2 u_offset;uniform vec3 u_normal;uniform vec3 u_tangent;uniform vec3 u_binormal;uniform mat3 u_toTangentSpace;const float A=acos(-1.);const vec2 B=vec2(1.,0.);const int C=12;const float D=1000.;float E(vec2 F){return fract(sin(dot(F.xy,vec2(12.9898,78.233)))*43758.5453);}void G(in int H,out float I,out float J,out vec2 K,out float L,out float M){I=abs(0.05*E(vec2(H,H)));J=.02+.01*E(vec2(float(H+5)));K=(vec2(E(vec2(H,H+1)),E(vec2(H-2,H+2))));L=30.+82.*E(vec2(float(H+5)));M=(2.5+4.2*E(vec2(float(H+4))))*0.00045;}float N(float O){return round(O*D)/D;}void P(in vec2 Q,in float R,in float S,out vec3 T,out vec3 U){T=vec3(Q,0.);U=B.yyy;float I,L,M,J;vec2 K;for(int H=0;H<C;++H){G(H,I,J,K,L,M);I+=R*0.1;J+=R*0.3;float V=dot(K,Q);T+=vec3(I*J*K*cos(L*V+N(M)*S*A*2.),J*sin(L*V+N(M)*S*A*2.));}for(int H=0;H<C;++H){G(H,I,J,K,L,M);U+=vec3(-K*L*J*cos(L*dot(K,T.xy)+N(M)*S*A*2.),1.-I*L*J*sin(L*dot(K,T.xy)+N(M)*S*A*2.));}U=normalize(U);}void main(){vec4 W=texture(u_mask,v_texCoord);vec4 X=texture(u_depth,v_texCoord);float R=smoothstep(0.,1.,X.a);float Y=1.-W.a;vec3 Z=B.yyx,a=1.*B.xyy,b=1.*B.yxy+B.yyx,V=normalize(cross(b,a)),c=Z+(v_texCoord.x+u_offset.x)*a+(v_texCoord.y-u_offset.y)*b;vec3 d=(B.yyx-3.*B.yxy),e=mat3(B.yxy,B.yyx,1./V.z,-V.x/V.z,-V.y/V.z)*c,f,T;P(e.xy,R,u_time,T,f);vec3 g=normalize(cross(f.x*u_normal+u_binormal,f.y*u_normal+u_tangent))*u_toTangentSpace;o_albedo=vec4(50./255.+R*0.5,124./255.+R*0.5,T.z/255.+224./255.+R,Y);if(R<0.99){vec4 h=texture(u_depth,v_texCoord-f.xy*4.);if(h.r>0.001){o_albedo=vec4(h.rgb*R/2.+o_albedo.rgb*(1.-R/2.),Y);}}o_normal=vec4(g,Y);o_specular=vec4(1.,1.,1.,Y);o_lighting=vec4(0.,0.,0.,0.);o_mask=vec4(0.,0.,0.,0.);}`,name:"water.frag",inAttributes:{},outAttributes:{o_normal:{type:"vec4",location:0},o_albedo:{type:"vec4",location:1},o_specular:{type:"vec4",location:2},o_lighting:{type:"vec4",location:3},o_mask:{type:"vec4",location:4}},uniforms:{u_mask:"sampler2D",u_depth:"sampler2D",u_time:"float",u_offset:"vec2",u_normal:"vec3",u_tangent:"vec3",u_binormal:"vec3",u_toTangentSpace:"mat3"}},kt=kn;var Pe=class{#e;#t;#n;constructor(t){this.#e=t.gl,this.#t=new U(t,ue,kt),this.#n=new B(this.#e)}draw(t,r,n,i){return this.#t.use(a=>{a.setUniforms({u_normal:j,u_tangent:X,u_binormal:Q,u_toTangentSpace:he,u_time:t,u_offset:r,u_mask:n[S],u_depth:i[S]}),this.#n.bind(this.#t,{position:"a_position"},o=>{o.draw()})}),this}};var me=.25,de=5,Gt=2,G=1e3,pe=class{constructor(){}onStart(t,r){if(r&&r.version!==Gt)throw new Error(`Invalid save version ${r.version}`);return{spriteEffect:new Ee(t),simpleSpriteEffect:new Ae(t),solidEffect:new Me(t),resources:new Se({ui:ee(t,_t,Bt),map:ft(t,b,le,_e),character:(async()=>{let i=await ee(t,Tt,_e);return{sprite:i,animator:new Te(i,r?r.character.direction:"walk_d",8/1e3),position:r?x.fromValues(r.character.position[0],r.character.position[1]):x.fromValues(le.startPosition.x*b,le.startPosition.y*b),relativePosition:x.create(),boundingBox:w.fromValues(i.walk_u.height-14,i.walk_u.width-2,i.walk_u.height-4,2),speed:1}})()}),waterEffect:new Pe(t),blurEffect:new we(t),animationTimer:0,screen:{absolutePosition:x.create()},moveTouch:null}}onSave(t){let r=null;return t.resources.ifReady(n=>{r={version:Gt,character:{position:[n.character.position[0],n.character.position[1]],direction:n.character.animator.getSpriteName()}}}),r}onUpdate(t,r,n){r.resources.ifReady(i=>{let a={},o=t.getGamepad();o&&((o.buttons[12].pressed||Math.min(0,o.axes[1]+me)<0)&&(a.up=!0),(o.buttons[13].pressed||Math.max(0,o.axes[1]-me)>0)&&(a.down=!0),(o.buttons[14].pressed||Math.min(0,o.axes[0]+me)<0)&&(a.left=!0),(o.buttons[15].pressed||Math.max(0,o.axes[0]-me)>0)&&(a.right=!0)),t.keys.pressed.has("f")&&t.keys.down.has("Control")&&(document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():t.canvas.requestFullscreen()),(t.keys.down.has("w")||t.keys.down.has("ArrowUp"))&&(a.up=!0),(t.keys.down.has("s")||t.keys.down.has("ArrowDown"))&&(a.down=!0),(t.keys.down.has("a")||t.keys.down.has("ArrowLeft"))&&(a.left=!0),(t.keys.down.has("d")||t.keys.down.has("ArrowRight"))&&(a.right=!0);for(let[m,f]of t.touches.down)r.moveTouch===null&&Date.now()-f.started>250&&(r.moveTouch={id:m,startPosition:x.clone(f.position)});for(let[m,f]of t.touches.ended)r.moveTouch!==null&&m===r.moveTouch.id&&(r.moveTouch=null);if(r.moveTouch!==null){let m=t.touches.down.get(r.moveTouch.id);m?(m.position[0]-r.moveTouch.startPosition[0]<-de&&(a.left=!0),m.position[0]-r.moveTouch.startPosition[0]>de&&(a.right=!0),m.position[1]-r.moveTouch.startPosition[1]<-de&&(a.up=!0),m.position[1]-r.moveTouch.startPosition[1]>de&&(a.down=!0)):r.moveTouch=null}let s=null;a.left?s="walk_l":a.right?s="walk_r":a.up?s="walk_u":a.down&&(s="walk_d"),s&&i.character.animator.setSpriteOrTick(s,n),r.animationTimer+=n/10,r.animationTimer>G&&(r.animationTimer-=G);let c=x.create();a.left&&c[0]--,a.right&&c[0]++,a.up&&c[1]--,a.down&&c[1]++,x.normalize(c,c),x.scale(c,c,i.character.speed),x.add(c,c,i.character.position);let h=x.fromValues(i.character.animator.getSprite().width/2,i.character.animator.getSprite().height/2);if(i.map.data.read(Math.floor((c[0]-h[0]+i.character.boundingBox[3])/b),Math.floor((c[1]-h[1]+i.character.boundingBox[0])/b)).walkable&&i.map.data.read(Math.floor((c[0]-h[0]+i.character.boundingBox[1])/b),Math.floor((c[1]-h[1]+i.character.boundingBox[0])/b)).walkable&&i.map.data.read(Math.floor((c[0]-h[0]+i.character.boundingBox[3])/b),Math.floor((c[1]-h[1]+i.character.boundingBox[2])/b)).walkable&&i.map.data.read(Math.floor((c[0]-h[0]+i.character.boundingBox[1])/b),Math.floor((c[1]-h[1]+i.character.boundingBox[2])/b)).walkable){let m=x.fromValues(i.character.animator.getSprite().width/2,i.character.animator.getSprite().height/2),f=x.fromValues(i.map.data.width*b,i.map.data.height*b);x.subtract(f,f,m),x.min(i.character.position,c,f),x.max(i.character.position,i.character.position,m)}i.character.relativePosition[0]=i.character.position[0]<t.screen.width/2?i.character.position[0]:i.character.position[0]>i.map.data.width*b-t.screen.width/2?i.character.position[0]-i.map.data.width*b+t.screen.width:t.screen.width/2,i.character.relativePosition[1]=i.character.position[1]<t.screen.height/2?i.character.position[1]:i.character.position[1]>i.map.data.height*b-t.screen.height/2?i.character.position[1]-i.map.data.height*b+t.screen.height:t.screen.height/2,x.subtract(r.screen.absolutePosition,i.character.position,i.character.relativePosition),i.map.data.updateScreenBuffer(t,r.screen.absolutePosition)})}onDraw(t,r,n){t.gl.enable(t.gl.BLEND),t.gl.blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA);let i=oe(w.create(),r.screen.absolutePosition),a=Math.sin(r.animationTimer);a=Math.min(1,a+.5);let o=r.animationTimer<G*.25?ye(0,G*.25,r.animationTimer):r.animationTimer<G*.5?1:r.animationTimer<G*.75?1-ye(G*.5,G*.75,r.animationTimer):0,s=Math.cos(Math.min(r.animationTimer,G*.75)*Math.PI/(G*.75));r.spriteEffect.addDirectionalLight({ambient:R.fromValues(.2+o*.3,.2+o*.3,.4+o*.1),direction:R.fromValues(s,o*.3+.2,-1),diffuse:R.fromValues(Math.pow(o,.25)*(1-o)+o*.5,o*.5,o*.45)}).addDirectionalLight({ambient:R.create(),direction:R.fromValues(0,(1-o)*.5,-1),diffuse:R.fromValues((1-o)*.2,(1-o)*.2,(1-o)*.2)}).addPointLight({diffuse:R.fromValues(.6*(1-o),.6*(1-o),.3*(1-o)),position:R.fromValues(t.mouse.position[0]/t.screen.width,t.mouse.position[1]/t.screen.height,.1),radius:.5}).use({width:t.screen.width,height:t.screen.height},(c,h)=>{r.resources.ifReady(u=>{if(h===0)for(let m=-1;m<=(t.screen.width+2)/b;++m)for(let f=-1;f<=(t.screen.height+2)/b;++f){let g=m+i[0],v=f+i[1],_=t.screen.toScreenSpace(w.create(),w.fromValues(f*b-i[3],m*b+b-i[2],f*b+b-i[3],m*b-i[2])),T=u.map.data.read(g,v);if(T.index!==0){let I=u.map.spriteConfig.indexes[T.index];u.map.sprite[I].draw(c,_,T.spatialHash?ut(g,v):void 0)}}else{let m=x.fromValues(u.character.animator.getSprite().width/2,u.character.animator.getSprite().height/2);u.character.animator.draw(c,t.screen.toScreenSpace(w.create(),w.fromValues(Math.floor(u.character.relativePosition[1])-m[1],Math.floor(u.character.relativePosition[0])+m[0],Math.floor(u.character.relativePosition[1])+m[1],Math.floor(u.character.relativePosition[0])-m[0])))}})},c=>{let h=x.clone(r.screen.absolutePosition);x.div(h,h,x.fromValues(t.screen.width,t.screen.height)),r.blurEffect.draw(c,3),r.waterEffect.draw(r.animationTimer,h,c,r.blurEffect.getBlurTexture())}),r.simpleSpriteEffect.use(c=>{let h=r.spriteEffect.getLightingTexture();if(h&&(c.setTextures(h),c.draw(w.fromValues(1,1,0,0),w.fromValues(0,h.width,h.height,0))),r.moveTouch!==null){let u=r.moveTouch;c.setAlpha(.5),r.resources.ifReady(m=>{m.ui.touch.draw(c,t.screen.toScreenSpace(w.create(),w.fromValues(Math.round(u.startPosition[1])-32,Math.round(u.startPosition[0])+32,Math.round(u.startPosition[1])+32,Math.round(u.startPosition[0])-32)))})}})}};function Re(e){let t=document.createElement("canvas");t.style.imageRendering="pixelated";let r=t.getContext("webgl2",{alpha:!1,premultipliedAlpha:!1});if(!r)return console.error("Unable to initialize WebGL. Your browser or machine may not support it."),null;let n=null,i={width:1,height:1},a={offsetLeft:0,offsetTop:0,width:1,height:1},o=e.editorSocket,s={gl:r,editor:{send:l=>{o?.send(JSON.stringify(l))}},createOffscreenCanvas:(l,d,M)=>{let E=document.createElement("canvas");E.width=l,E.height=d;let A=E.getContext("2d",M);return A||console.error("Unable to initialize OffscreenCanvas. Your browser or machine may not support it."),A},canvas:t,getGamepad:()=>n!==null?navigator.getGamepads()[n]:null,keys:{down:new Set,pressed:new Set},mouse:{position:x.create(),wheel:x.create(),down:[],clicked:[]},touches:{down:new Map,ended:new Map},screen:{get width(){return i.width},get height(){return i.height},safeArea:{get width(){return i.width},get height(){return i.height},get boundingRect(){return w.fromValues(a.offsetTop,a.offsetLeft+a.width,a.offsetTop+a.height,a.offsetLeft)}},toScreenSpace:(l,d)=>w.set(l,d[0]/i.height,d[1]/i.width,d[2]/i.height,d[3]/i.width)}},c=1;window.addEventListener("gamepadconnected",l=>{n=l.gamepad.index}),window.addEventListener("gamepaddisconnected",l=>{n=null}),window.addEventListener("keydown",l=>{s.keys.down.add(l.key),(l.altKey||l.shiftKey||l.ctrlKey)&&l.preventDefault()}),window.addEventListener("keyup",l=>{s.keys.down.has(l.key)&&s.keys.pressed.add(l.key),s.keys.down.delete(l.key),(l.altKey||l.shiftKey||l.ctrlKey)&&l.preventDefault()}),t.addEventListener("wheel",l=>{l.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&x.set(s.mouse.wheel,l.deltaX,l.deltaY)}),t.addEventListener("mousemove",l=>{let d=t.getBoundingClientRect();x.set(s.mouse.position,(l.clientX-d.left)/c,(l.clientY-d.top)/c)}),t.addEventListener("mousedown",l=>{s.mouse.down[l.button]=!0}),t.addEventListener("mouseup",l=>{s.mouse.down[l.button]&&(s.mouse.clicked[l.button]=!0),s.mouse.down[l.button]=!1}),t.addEventListener("contextmenu",l=>{l.preventDefault()}),t.addEventListener("touchstart",l=>{let d=t.getBoundingClientRect();for(let M=0;M<l.changedTouches.length;++M){let E=l.changedTouches[M],A=x.fromValues((E.clientX-d.left)/c,(E.clientY-d.top)/c);A[0]>=0&&A[1]>=0&&A[0]<=s.screen.width&&A[1]<=s.screen.height&&s.touches.down.set(E.identifier,{started:Date.now(),position:A})}l.preventDefault()}),t.addEventListener("touchmove",l=>{let d=t.getBoundingClientRect();for(let M=0;M<l.changedTouches.length;++M){let E=l.changedTouches[M],A=s.touches.down.get(E.identifier);A&&x.set(A.position,(E.clientX-d.left)/c,(E.clientY-d.top)/c)}l.preventDefault()}),t.addEventListener("touchend",l=>{let d=t.getBoundingClientRect();for(let M=0;M<l.changedTouches.length;++M){let E=l.changedTouches[M],A=s.touches.down.get(E.identifier);A&&(x.set(A.position,(E.clientX-d.left)/c,(E.clientY-d.top)/c),s.touches.down.delete(E.identifier),s.touches.ended.set(E.identifier,{position:A.position}))}l.preventDefault()}),t.addEventListener("touchcancel",l=>{for(let d=0;d<l.changedTouches.length;++d){let M=l.changedTouches[d];s.touches.down.get(M.identifier)&&s.touches.down.delete(M.identifier)}l.preventDefault()});let h=performance.now(),u=()=>{let l=localStorage.getItem(e.saveKey),d=localStorage.getItem(`${e.saveKey}-editor`);h=performance.now();let M=(()=>{try{return e.game.onStart(s,l?JSON.parse(l):void 0)}catch(A){return console.warn(A),e.game.onStart(s)}})(),E=e.editor?(()=>{try{return e.editor?.onEnd(e.container),e.editor?.onStart(s,M,e.container,d?JSON.parse(d):void 0)}catch(A){return console.warn(A),e.editor?.onEnd(e.container),e.editor?.onStart(s,M,e.container)}})():null;return{gameState:M,editorState:E}},m=!1,f={...u(),canvas:t};e.editor?(o?.addEventListener("message",l=>{f.editorState&&e.editor?.onEvent(s,f.gameState,f.editorState,JSON.parse(l.data))}),o?.addEventListener("close",()=>{f.editorState&&e.editor?.onEvent(s,f.gameState,f.editorState,{type:"EDITOR_DISCONNECTED"})})):e.container.appendChild(t),t.addEventListener("webglcontextlost",l=>{l.preventDefault(),m=!0,console.warn("WebGL context lost, saving state..."),f.gameState&&localStorage.setItem(e.saveKey,JSON.stringify(e.game.onSave(f.gameState))),f.editorState&&e.editor&&localStorage.setItem(`${e.saveKey}-editor`,JSON.stringify(e.editor.onSave(f.editorState)))},!1),t.addEventListener("webglcontextrestored",l=>{l.preventDefault(),s.gl=t.getContext("webgl2"),console.warn("WebGL context restored, loading state..."),Object.keys(f.gameState).forEach(d=>{delete f.gameState[d]}),f.editorState&&Object.keys(f.editorState).forEach(d=>{delete f.editorState[d]}),Object.assign(f,u()),m=!1},!1);let g=0,v=null,_=()=>{let l=performance.now(),d=l-h;for(h=l,g+=d;g>=e.fixedUpdate;)e.game.onUpdate(s,f.gameState,e.fixedUpdate),f.editorState&&e.editor?.onUpdate(s,f.gameState,f.editorState,e.fixedUpdate),s.mouse.clicked=[],x.set(s.mouse.wheel,0,0),s.touches.ended.clear(),s.keys.pressed.clear(),g-=e.fixedUpdate;m||(e.game.onDraw(s,f.gameState,d),f.editorState&&e.editor?.onDraw(s,f.gameState,f.editorState,d)),v=requestAnimationFrame(_)};v=requestAnimationFrame(_);let T=()=>{if(document.visibilityState==="hidden"){console.warn("Visibility changing, saving state...");let l=e.game.onSave(f.gameState);if(l&&localStorage.setItem(e.saveKey,JSON.stringify(l)),f.editorState){let d=e.editor?.onSave(f.editorState);d&&localStorage.setItem(`${e.saveKey}-editor`,JSON.stringify(d))}v&&cancelAnimationFrame(v)}else h=performance.now(),g=0,v=requestAnimationFrame(_)};window.addEventListener("visibilitychange",T);let I=()=>{if(c=1,e.container.clientWidth>=e.container.clientHeight){for(i.width=Math.min(e.screen.preferredWidthIncrements,Math.floor(e.container.clientWidth/e.screen.incrementSize))*e.screen.incrementSize;i.width*(c+1)<e.container.clientWidth;)++c;i.height=Math.floor(e.container.clientHeight/(e.screen.incrementSize*c))*e.screen.incrementSize}else{for(i.height=Math.min(e.screen.preferredHeightIncrements,Math.floor(e.container.clientHeight/e.screen.incrementSize))*e.screen.incrementSize;i.height*(c+1)<e.container.clientHeight;)++c;i.width=Math.floor(e.container.clientWidth/(e.screen.incrementSize*c))*e.screen.incrementSize}for(;i.width*c<e.container.clientWidth;)i.width+=e.screen.incrementSize;for(;i.height*c<e.container.clientHeight;)i.height+=e.screen.incrementSize;let l=(i.width*c-e.container.clientWidth)/2,d=(i.height*c-e.container.clientHeight)/2;a.offsetLeft=l,a.offsetTop=d,a.width=i.width-l*2,a.height=i.height-d*2,t&&(t.setAttribute("width",i.width.toString()),t.setAttribute("height",i.height.toString()),t.style.top=-d+"px",t.style.left=-l+"px",t.style.width=c*i.width+"px",t.style.height=c*i.height+"px")};return I(),new ResizeObserver(l=>{for(let d of l)d.target===e.container&&I()}).observe(e.container),f}var Ot=document.getElementById("root");if(Ot){let e={fixedUpdate:1e3/60,saveKey:"pixelheart",game:new pe,editor:null,editorSocket:null,screen:{incrementSize:16,preferredWidthIncrements:20,preferredHeightIncrements:13},container:Ot};Re(e)}})();
//# sourceMappingURL=index.js.map
